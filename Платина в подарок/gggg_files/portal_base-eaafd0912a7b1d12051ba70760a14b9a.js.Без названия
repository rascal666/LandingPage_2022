function getFullDate(e){var t=new Date,n=t.getMonth(),i=t.getDate(),a=t.getFullYear(),o=["\u044f\u043d\u0432\u0430\u0440\u044f","\u0444\u0435\u0432\u0440\u0430\u043b\u044f","\u043c\u0430\u0440\u0442\u0430","\u0430\u043f\u0440\u0435\u043b\u044f","\u043c\u0430\u044f","\u0438\u044e\u043d\u044f","\u0438\u044e\u043b\u044f","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043d\u0442\u044f\u0431\u0440\u044f","\u043e\u043a\u0442\u044f\u0431\u0440\u044f","\u043d\u043e\u044f\u0431\u0440\u044f","\u0434\u0435\u043a\u0430\u0431\u0440\u044f"],r=o[n];$(e).text(i+" "+r+" "+a+" \u0433\u043e\u0434\u0430.")}function tableMessage(){$doc.on("click",".b-table-cell, .b-table-headCell",function(){var e=$(this).parents("tr").children().index($(this));0!=e&&(removeAllStyles(),makeNewStyles(e))})}function makeNewStyles(e){var t,n,i,a=[".js-table-firstCol",".js-table-secondCol",".js-table-thirdCol",".js-table-fourthCol",".js-table-fifthCol"];i=$(".js-packets div").eq(e-1).html(),t=a[e-1],n=$("tr:first-child "+t).html(),$(".js-table-thirdCol").removeClass("b-table_firstCell"),$(t).addClass("b-table_firstCell"),$("tr:last-child "+t).html('<div class="b-table-cellInsideCover"></div>'),$("tr:first-child "+t).html('<div class="b-table-cellInsideTopCover"><div class="b-table-cellInsideTop"></div>'+n+"</div>"),$(".b-tableCover-message").html(i),$(".b-tableCover-message").toggleClass("b-tableCover_messageWithoutRBCorner",!$(this).is(":last-child"))}function removeAllStyles(){$(".b-table-cell, .b-table-headCell").removeClass("b-table_firstCell"),$(".b-table-cellInsideTopCover").parent().text($(".b-table-cellInsideTopCover").text().replace(/\s*/g,"")),$(".b-table-cellInsideTopCover, .b-table-cellInsideCover").remove()}function checkEmail(e){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e.val())}function checkName(e){return/^[-\u0430-\u044f\u0410-\u042f\u0451\u0401\u044a\u042a\s]*$/.test(e.val())}function makeStringShorter(e,t){e.each(function(){var e=$(this);e.text().length<t||e.data("text",e.text()).text(e.text().substring(0,t)).append($('<span class="three-dots">').text("...")).on("click",".three-dots",function(){var e=$(this).parent();return e.text(e.data("text")),!1})})}function showImgLoadAttentionMessage(e){var t;$doc.on("click",".js-ajaxupload-button",function(n){var i=$(".js-img-load-block"),a=$(".js-load-img .js-mini-image");if(localStorage&&localStorage.showImgLoadMessage===e||!localStorage&&!a.length||!a.length)return void i.removeClass("js-load-img");t=$(this),localStorage&&(localStorage.showImgLoadMessage=e),openStaticPopup("js-load-img-attention-message"),i.removeClass("js-load-img"),n.preventDefault()}),$doc.on("click",".js-load-img-button",function(){t.trigger("click"),hidePopup("popup-container")}),$doc.on("click",".js-cancel-img-load-button",function(e){hidePopup("popup-container"),e.preventDefault()}),$(".js-img-load-block").mouseenter(function(){$(".js-img-load-block").removeClass("js-load-img"),$(this).addClass("js-load-img")})}function showRegionsPopup(e){var t=e&&$.isFunction(e)?e:$.noop;$("#popup-container .js-regions").length?(showPopup($("#popup-container"),!0),t(),u_reRenderPopup(),changeTabs()):$.ajax({url:"/ajax/region_selector",dataType:"html",success:function(e){$("#popup-content").html(e).show(),t()},failure:function(){alert("\u041e\u0448\u0438\u0431\u043a\u0430. \u0421\u043e\u043e\u0431\u0449\u0438\u0442\u0435 \u043d\u0430\u043c \u043e\u0431 \u044d\u0442\u043e\u043c \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e.")},beforeSend:function(){u_showLoading()},complete:function(){u_reRenderPopup(),changeTabs()}})}function changeTabs(){$doc.on("click","#regions .cntr-list a",function(){var e=$(this).parent();return e.addClass("selected").siblings().removeClass("selected"),$(".js-regions .cities > div").hide().eq(e.index()).show(),u_reRenderPopup(),!1})}function showFlashMessage(e,t){var n,i;switch(e){case"failure":case"error":n="failure",i="fa-exclamation-circle";break;case"notice":n="notice",i="fa-info-circle";break;default:n="success",i="fa-check-circle"}$("header").append($("<div>").addClass("js-flash").append($("<div>").addClass("flash-message "+n).append($("<i>").addClass("fa "+i),$("<p>").addClass("fm-text").text(t))))}function isTouchDevice(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function toggleAttr(e,t,n){e.attr(t,e.attr(t)===n[0]?n[1]:n[0])}function resizeFHelper(){var e=$(".js-f-container"),t=e.height();$(".js-error-page").css("padding-bottom",t)}function prepareLink(e){var t,n,i=e.data();return $.isEmptyObject(i)||(t=i.gaIdAdded,n=i.titleAdded),e.addClass("filled user-favorites-added tools-links__item-content_active js-user-favorites-added").removeClass("js-add-favorite-company-ga").parent().addClass("tools-links__item_active").end().find("i").removeClass("fa-bookmark-o").addClass("fa-bookmark").end().find("span").text("\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u043c").closest(".js-product").addClass("belongs-to-favorites"),n&&e.attr({title:n}),t&&e.data({gaId:t}),e}function loadFavoriteGroups(e){var t=$(this);return!(!e&&"object"!=typeof e||e.validLimit&&validLimit(t))&&($.isArray(favoriteGroups)&&favoriteGroups.length||"forbidden"==favoriteGroups?(e.callback&&e.callback.apply(this,[e.params]),!1):void $.ajax({url:app.config.userFavorites.favoriteGroupsUrl,beforeSend:function(){t.addClass("loading")},dataType:"json",success:function(n){if(favoriteGroupsLimit={count:n.count,limit:n.limit},e.validLimit&&validLimit(t))return!1;"forbidden"!=n.result?favoriteGroups=favoriteGroups.concat(n.groups):favoriteGroups="forbidden",e.callback&&e.callback.apply(t[0],[e.params])},complete:function(){t.removeClass("loading")},error:function(){alert("\u041f\u0440\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430.")}}))}function validLimit(e){return favoriteGroupsLimit.count>=favoriteGroupsLimit.limit&&($("body").append($("<div>").css({left:e.offset().left,top:e.offset().top}).addClass("favorite-group-window js-favorite-group-window").append($("<div>").addClass("fgw-header").html("\u0412\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0431\u043e\u043b\u0435\u0435 "+favoriteGroupsLimit.limit+" \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a\u043e\u0432."))),!0)}function showMoveGroupPopup(){var e=$(this),t=e.data("company-id"),n=e.offset(),i=$(".js-favorite-companies-list").data(),a=i.groupsCount>=i.groupsMaxCount;$("body").append($(HandlebarsTemplates["user_favorites/move_to_group_popup"]({groups:favoriteGroups,isForbidden:"forbidden"===favoriteGroups,companySelected:t.length,maxGroupsCountReached:a,canCreateGroup:t.length&&!a})).css({left:n.left,top:n.top+e.outerHeight()}).data({"company-id":t}))}function saveCompanyFavoriteGroup(e){var t,n=$(".js-favorite-group-window"),i=n.length?n.data("company-id"):$(this).data("company-id"),a=$.isArray(i),o=app.config.userFavorites.favorites.moveToGroupUrl,r=app.config.userFavorites.favorites.newUrl,s=a?o:r,l=a?{ids:i}:{company_id:i},c=$('.js-add-favorite-company[data-company-id="'+i+'"]');"undefined"!=typeof e.groupId?l=$.extend({group_id:e.groupId},l):"undefined"!=typeof e.title&&"object"!=typeof e.title?l=$.extend({group_title:e.title},l):(t=$(this).data("slug"))&&(l=$.extend({group_id:t},l)),$.ajax({type:a?"POST":"GET",url:s,dataType:a?"text":"json",data:l,beforeSend:function(){c.addClass("loading")},success:function(t){if(n.remove(),"OK"==t)return $doc.trigger("saveCompany:userFavorites"),e.title&&$doc.trigger("createGroup:userFavorites"),location.reload(!0),!0;"OK"==t.result?(favoriteGroupsLimit.count+=1,$doc.trigger("addFavoriteCompany:userFavorites"),c=prepareLink(c),favoriteGroupsLimit.count==favoriteGroupsLimit.limit&&(c.after($("<div>").addClass("red mt5").text("\u0414\u043e\u0441\u0442\u0438\u0433\u043d\u0443\u0442 \u043b\u0438\u043c\u0438\u0442 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0439")),setTimeout(function(){c.next().remove()},5e3))):"ALREADY SAVED"==t.result?c=prepareLink(c):"ERROR"==t.result?c.addClass("with-icon").find("span").text("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430..."):"LIMIT EXCEEDED"==t.result&&(favoriteGroupsLimit.count=favoriteGroupsLimit.limit,c.addClass("with-icon").find("span").text("\u0412\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0431\u043e\u043b\u0435\u0435 "+favoriteGroupsLimit.limit+" \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a\u043e\u0432."))},complete:function(){c.removeClass("loading")},error:function(){alert("\u041f\u0440\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430."),n.remove()}}),0===t?$doc.trigger("clickSelectedGroup"):t&&$doc.trigger("clickUserGroup")}function newCompanyFavoriteGroup(){var e=$.trim($(".js-favorite-group-input").val()),t=$(".js-favorite-group-window").data("errors"),n=!1;return(e=e.replace(/\.$/gi,""))?($(".js-favorite-group-item").each(function(){if($(this).text().toUpperCase()==e.toUpperCase())return n=!0,!1}),n?($(".js-favorite-group-error").html(t.unique).show(),!1):/\||\(|\)|`|\'|\,|\?|\"|\.$/gi.test(e)?($(".js-favorite-group-error").html(t["invalid-title"]).show(),!1):(favoriteGroups=[],saveCompanyFavoriteGroup({title:e.slice(0,35)}),!1)):($(".js-favorite-group-error").html(t.required).show(),!1)}function hideFavoritesCompanies(e){e&&(app.config.favoritesCompanies=e),$.each(app.config.favoritesCompanies,function(e,t){prepareLink($(".js-add-favorite-company[data-company-id="+t+"]"))})}function eventListener(){function e(){var e=$.Deferred();return $doc.trigger("register:authComponent",[e,{withSID:!0,crossDomainAuth:app.config.crossDomainAuth}]),e}function t(e){loadFavoriteGroups.apply(e,[{validLimit:!0,callback:saveCompanyFavoriteGroup,params:{groupId:0}}]),$doc.trigger("addToFavorites:userFavorites",e)}$doc.on("keydown",".js-favorite-group-input",function(e){13===e.which&&$(".js-save-favorite-group").click()}).on("click",".js-create-favorite-group",function(){newCompanyFavoriteGroup(),$doc.trigger("save:userFavorites")}).on("click",".js-favorite-group-item",saveCompanyFavoriteGroup).on("click",".js-add-favorite-company",function(n){n.preventDefault();var i=this;$(".js-favorite-group-window").remove(),$(this).hasClass("js-user-favorites-added")||(app.config.isUserSigned?t(this):e().then(function(){t(i)}))}).on("click",".js-move-to-group",function(){var e=$(".js-favorite-group-window");return $(this).data("company-id",$.makeArray($(".js-favorite-company-checkbox:checked").map(function(){return $(this).val()}))),e.length?void e.remove():(loadFavoriteGroups.apply(this,[{callback:showMoveGroupPopup}]),!1)}).on("click",function(e){$(e.target).closest(".js-favorite-group-window, .js-move-to-group, .js-add-favorite-company").length||$(".js-favorite-group-window").remove()}).on("click",".js-user-favorites-added",function(){window.open("//"+app.config.mainHost+"/dashboard/favorites"),$doc.trigger("goToFavorites:userFavorites",this)}).on("hideFavoritesCompanies",function(e,t){hideFavoritesCompanies(t)}),$win.on("resize",function(){$(".js-favorite-group-window").remove()})}Facets=function(){var e,t,n={openedCount:3},i=[],a=0,o=function(){$(".js-flil-text").each(function(){var e=$(this),t=e.data("id");e.data("checked")&&(i.push(t),a++,e.addClass("fli-checked"))})},r=function(){$(".js-f-name").click(function(){var e=$(this),t=e.parent().find(".js-facet-sort"),n=e.closest(".js-facet").hasClass("hide-facet-list");b(e.siblings(".js-facet-list-cover")),e.toggleClass("pressed",!n).closest(".js-facet").toggleClass("hide-facet-list",!n),t.toggle(),e.siblings(".js-ajax-hidden-values").toggle()}),$doc.on("click",".js-flil-check",function(){var e=$(this),t=e.attr("id"),n=$(".js-tl-sub-header");e.prop("checked")?(i.push(t),e.closest(".js-flil-text").addClass("fli-checked")):(i.splice($.inArray(t,i)-1,1),e.closest(".js-flil-text").removeClass("fli-checked")),n.hasClass("invisible")&&n.removeClass("invisible"),f(e)}),n.use_price_range&&$("#slider-coast").sliderRange({min:parseFloat(n.min_price),max:parseFloat(n.max_price),minRange:parseFloat(n.min_price_with_filters),maxRange:parseFloat(n.max_price_with_filters),step:"round",tagSuffix:'<span class="rub">\u0440\u0443\u0431.</span>',changeValue:function(){clearTimeout(e),e=setTimeout(function(){f($(".slider-mark:eq(0)"))},400)}})},s=function(){var e={},t=$("#slider-coast").sliderRange("getValue");return t.min!=parseFloat(n.min_price)&&(e.price_min=t.min),t.max!=parseFloat(n.max_price)&&(e.price_max=t.max),e=jQuery.param(e)},l=function(){var e,t={},i=$("#slider-coast").sliderRange("getValue");return n.use_price_range&&(i.min!=parseFloat(n.min_price)&&(t.price_min=i.min),i.max!=parseFloat(n.max_price)&&(t.price_max=i.max)),e=u(),e&&(t.facets=e),t=jQuery.param(t)},c=function(e,t){return e=parseInt(e.position),t=parseInt(t.position),e<t?-1:e>t?1:0},d=function(e,t){var n=[];return $.each(e,function(){n.push(this.id)}),n.join(t)},u=function(){var e=[],t=[];if($(".js-facet input:checked").each(function(){var t=$(this),n=t.parent(),i={id:t.data("slug"),position:n.parent().data("position")},a=t.val();e[a]?e[a].push(i):e[a]=[i]}),e)for(var n in e)t.push({id:n+"_"+d(e[n].sort(c),"|"),position:n});return t?d(t.sort(c),"&"):""},p=function(){var e,t,i=n.rubric_url;return e=n.use_price_range?s():"",t=u(),""!=t&&(t="f:"+t,-1!=i.indexOf("?")?i=i.replace("?","/"+t+"?"):i+="/"+t),""!=e&&(i=i+(-1!=i.indexOf("?")?"&":"?")+e),location.href=i,!1},f=function(e){y(),$.ajax({url:n.clean_ajax_traits_filter_url,type:"POST",data:l(),dataType:"json",success:function(t){var n,i,a=t.traits,o=$(".js-show-facets-button");if(t.products.count){n=$('<a href="#" class="js-click-show-facets js-ga-link" data-ga-id="PC4-18057-5">\u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c</a>'),$doc.off("click","a.js-click-show-facets"),$doc.on("click","a.js-click-show-facets",function(){return p(),!1}),$(".js-b-order-button-facet").removeClass("disable-btn").prop("disabled",!1).on("click",function(){return n.click(),!1}),i=$("<div>").html("\u0412\u044b\u0431\u0440\u0430\u043d\u043e:&nbsp;"+t.products.count+"&nbsp;").append(n),v(e,i),o.removeClass("disable"),$(".js-flil-check").parent().addClass("disable-check");for(var r in a)$(".js-facet input[data-id='"+r+"']").parent().removeClass("disable-check")}else v(e,"<div>\u0412\u044b\u0431\u0440\u0430\u043d\u043e: 0</div>"),o.addClass("disable"),$(".js-b-order-button-facet").addClass("disable-btn").prop("disabled",!0).off("click")}})},h=function(){$(".js-facet-wrapped").addClass("hide-facet-list").find(".js-f-name").addClass("pressed").end().find(".js-ajax-hidden-values, .js-facet-sort").hide().end().removeClass("wrapped")},m=function(){return $("<li>").addClass("fl-item js-fl-item").html($("<label>").addClass("fli-label js-fli-label").append($("<input>").addClass("flil-check js-flil-check").attr("type","checkbox"),$("<div>").addClass("flil-content").append($("<div>").addClass("flil-title").html($("<a>").addClass("flil-text js-flil-text")),$("<span>").addClass("flil-num js-flil-num"))))},g=function(){$(".js-ajax-hidden-values, .js-f-name[data-facets-hidden]").one("click",function(){var e=$(this),t=m(),n=$("<div>"),i=e.closest(".js-facet-wrapped"),a=i.data();e.addClass("loading"),$.ajax({url:e.data("hidden-values-url"),type:"POST",success:function(e){$.each(e.trait_values,function(e,i){i=JSON.parse(i),n.append(t.clone().data("position",i.id).find(".js-flil-check").attr({id:"trait_filter_"+i.id,name:"trait-filter["+i.id+"]","data-id":i.id,"data-slug":i.slug}).val(a.position).end().find(".js-flil-text").attr("href",a.base_facet_url.replace("VALUE_SLUG",i.slug)).text(i.value).end().find(".js-flil-num").text(i.items_count).end())})},complete:function(){var t=i.find(".js-fl-item").add(n.html());i.addClass("hidden-values-loaded").find(".js-facet-list-cover").html($("<ul>").html(t)),$doc.trigger("showMoreTraits",e.removeClass("loading").closest(".js-facet"))}})})},v=function(e,n){y(),t=e,e.showBalloon({tipSize:0,hideDuration:0,showDuration:0,hideAnimation:null,position:"right",contents:n,classname:"fli-filter-link",offsetX:e.closest(".js-fli-label").find(".js-flil-text").width()+20,css:{height:"24px",padding:"0",borderRadius:"0","padding-right":"5px","padding-left":"8px",border:"1px solid #BC99A3","border-left":"0",boxShadow:"1px 5px 7px rgba(148, 148, 148, 0.7)",color:"#000",background:"none repeat scroll 0 0 #fff2e9",opacity:"1",textAlign:"left"}})},y=function(){t&&$(".fli-filter-link").hide()},b=function(e){var t=e.find(".js-component-trait"),n=$("<li>").addClass("fl-item js-fl-item").append($("<label>").addClass("fli-label js-fli-label").append($('<input type="checkbox">').addClass("flil-check js-flil-check"),$("<div>").addClass("flil-content").append($("<div>").addClass("flil-title"),$("<span>").addClass("flil-num js-flil-num"))));t.each(function(){var e=$(this),t=n.clone();t.attr("data-position",e.data("position")).find(".js-fli-label").addClass(e.data("labelclass")).find("input").attr({name:e.data("nameinput"),id:"trait-filter_"+e.data("id"),"data-id":e.data("id"),"data-slug":e.data("slug")}).prop("checked",e.data("checked")).val(e.data("traitid")).end().find(".flil-title").append(e.clone().removeClass("js-component-trait")).siblings(".js-flil-num").html(e.data("itemscount")),e.replaceWith(t)})},w=function(){var e=$('.js-flil-text[data-checked="true"]');(e.length?e.closest(".js-facet-wrapped").find(".js-f-name:not([data-facets-hidden])"):$(".js-f-name:not([data-facets-hidden])").slice(0,n.openedCount)).click()};return{init:function(e){$.extend(n,e),o(),r(),g(),h(),b($(".js-facet-list-cover:first")),w()},showBalloon:function(e,t){v(e,t)}}}(),app.modules.application=app.modules.application||{},app.modules.application.load=function(){function e(){var e=$(".ui-dialog");e.length&&e.position({of:window})}tableMessage(),$(".js-packets div").eq($("th.b-table_firstCell").index()-1).html($(".b-tableCover-message").html()),$doc.on("click",".js-main-button-kabinet, .js-toolbar-link-button-add-price, .js-footer-link-button-add-price, .js-firms-recent-link-button-add-price",function(){return $("#popup-content .js-companies-names").length||$("#popup-content").html($(".js-companies-names").clone(!0).show()),showPopup("popup-container",!0),!1}),showHideBox($(".js-more-span"),$(".js-regions-list-block"),"\u0421\u043a\u0440\u044b\u0442\u044c","\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435 \u0440\u0435\u0433\u0438\u043e\u043d\u044b","more-span-clicked"),$(".js-regions-list-block-cover span[data-url]").replaceWith(function(){var e=$(this),t=$("<a>"),n=e.text();return t.attr("href",e.data("url")).attr("class",e.data("class")).data("region",e.data("region")).data("relation",e.data("relation")).text(n),t}),$doc.on("click",".js-tb-item",function(){var e=$(this),t=e.index();e.hasClass("disabled")||($(".js-tb-item").removeClass("selected").eq(t).addClass("selected"),$(".js-tabs-content").hide().eq(t).show(),$doc.trigger("changeTab:base",[e.data("tab")]))}),$(".js-toggle").click(function(){$("."+$(this).data("target")).toggle()}),$doc.on("click",".js-vr-header",function(){$(".js-viewed-rubrics").toggleClass("collapsed")}),resizeFHelper(),$win.on("debouncedresize",resizeFHelper),$(".js-medal-pic").poshytip({className:"medal-poshytip-modern",content:function(){return $(this).find(".js-medal-tip").html()},offsetX:3,offsetY:0,slide:!1,showTimeout:200}).mouseenter(RatingTooltip.hide),$.ajaxSetup({cache:!1}),Comparison.initEvents(),$("html").toggleClass("touch-device",isTouchDevice()),$doc.on("click",".js-confirm-mail",function(e){var t=$(this),n=t.closest(".js-confirmation-link-wrapper"),i=t.data();if(i.confirmationSent)return!1;$.ajax({url:t.attr("href"),beforeSend:function(){n.addClass("in-process")},success:function(){t.data("confirmation-sent",!0),$doc.trigger("render:onlineFlash",[{text:i.successMessage,anchor:i.anchor||".js-base-width",template:i.template}]),n.removeClass("in-process").addClass("confirmation-sent")}}),e.preventDefault()}),$win.resize($.throttle(250,e))},app.modules.toolbarFixation=function(e){function t(){var e,t,n;$("#toolbar").length&&(e=$("#toolbar")),$("#inner-toolbar").length&&(e=$("#inner-toolbar")),null!=e&&(t=e.offset(),n=$win.scrollTop(),n>t.top&&e.addClass("toolbar-fixed"),$win.scroll(function(){var n=$win.scrollTop();e.toggleClass("toolbar-fixed",n>t.top)}))}return e.load=function(){t()},e}(app.modules.toolbarFixation||{}),app.modules.portalHeader=function(e){function t(){$(".js-psf-submit").prop("disabled",!$(".js-search-input").val())}function n(e,t){var n=t.find(".js-modern-popup");$(".js-pl-region").removeClass("clicked"),t.find(".js-pl-region").toggleClass("clicked",!n.hasClass("hidden"))}function i(){t(),~location.hash.indexOf("open_search")&&($(".js-search-input").val("").focus(),$(".js-psfssc-clear").hide())}function a(){var e=$(".js-ph-wrapper.fix"),i=e.offset();$doc.on("showRegionPopup hideRegionPopup",n).on("submit",".js-disabled-submit",function(){return!1}).on("keyup change input",".js-search-input",t).on("click",".js-psfssc-clear",function(){$(".js-search-input").val("").focus(),$(this).hide()}).on("keypress",".js-search-input",function(){$(".js-psfssc-clear").show()}),$win.scroll(function(){var t=e.width(),n=$win.scrollTop(),a=$(".js-top-helper").height();i&&n>=i.top-a&&(e.addClass("portal-header-fixed").width(t),$(".js-scrolled-to-top").length&&(e.removeClass("js-scrolled-to-top"),$(".js-search-input").blur())),i&&n<=i.top-a&&e.removeClass("portal-header-fixed").width("auto")}).resize(function(){e.length&&(width=e.parent().width(),e.width(width))})}return e.load=function(){a(),i()},e}(app.modules.portalHeader||{}),app.modules.googleAnalytics=app.modules.googleAnalytics||{},app.modules.googleAnalytics.load=function(){!function(e){var t,n,i,a,o,r=window.location.href;r.length;$doc.on("click",".js-catalogue-listing .js-prl-link",function(){dataLayer.push({event:"Event_1124"}),dataLayer.push({event:"Event_1230"})}),e(".js-reg-button-faq").click(function(){dataLayer.push({event:"GAevent",eventCategory:"\u041b\u0438\u0441\u0442\u0438\u043d\u0433 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432",eventAction:"UGC",eventLabel:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u043e\u043f\u0440\u043e\u0441"})}),$doc.on("showThirdStep.fastStart",function(){dataLayer.push({event:"Event_1164"})}),e(".js-portal-logo").click(function(){e(this).closest(".js-error-page-block").length&&yaCounter200476.reachGoal("404-goal")}),$doc.on("click",".js-rml-content a",function(){e(this).closest(".js-error-page-block").length&&yaCounter200476.reachGoal("404-goal")}),$doc.on("click",".js-user-favorites-added",function(){var t;e(".js-firms-list").length&&(t=1169),e(".js-products-list").length&&(t=1170),e(".js-company-block").length&&(t=1171),t&&dataLayer.push({event:"Event_"+t})}),t=e(".js-checkbox-groups").prop("checked"),e(".js-products-on-main-settings").submit(function(){!t&&e(".js-checkbox-groups").prop("checked")&&dataLayer.push({event:"Event_1172"})}),$doc.on("productGroupsForm.group.added",function(){dataLayer.push({event:"Event_1044"})}),e(".js-product .js-cbl-inside").click(function(){e(".js-product").length&&dataLayer.push({event:"GAevent",eventCategory:"\u041b\u0438\u0441\u0442\u0438\u043d\u0433 \u0442\u043e\u0432\u0430\u0440\u043e\u0432",eventAction:"\u041f\u0435\u0440\u0435\u0437\u0432\u043e\u043d\u0438\u0442\u0435 \u043c\u043d\u0435"})}),$doc.on("phoneSentWithSuccess",function(){e(".js-product").length&&dataLayer.push({event:"GAevent",eventCategory:"\u041b\u0438\u0441\u0442\u0438\u043d\u0433 \u0442\u043e\u0432\u0430\u0440\u043e\u0432",eventAction:"\u041f\u0435\u0440\u0435\u0437\u0432\u043e\u043d\u0438\u0442\u0435 \u043c\u043d\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0430"})}),$doc.on("click",".js-psws-button",function(){e(".js-product").length&&dataLayer.push({event:"GAevent",eventCategory:"\u041b\u0438\u0441\u0442\u0438\u043d\u0433 \u0442\u043e\u0432\u0430\u0440\u043e\u0432",eventAction:"\u041f\u0435\u0440\u0435\u0437\u0432\u043e\u043d\u0438\u0442\u0435 \u043c\u043d\u0435 \u043f\u0435\u0440\u0435\u0445\u043e\u0434 \u043d\u0430 \u0421\u041a \u0441 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"})}),e(".js-edit-product-form").submit(function(){dataLayer.push({event:"GAevent",eventCategory:"\u0421\u041a: \u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430\u043c\u0438",eventAction:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430",eventLabel:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435"})}),e(".js-add-product-form").submit(function(){dataLayer.push({event:"GAevent",eventCategory:"\u0421\u041a: \u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430\u043c\u0438",eventAction:"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430",eventLabel:"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435"})}),e(".js-show-regions-popup").click(function(){e(".js-demands-rubricator").length&&dataLayer.push({event:"GAevent",eventCategory:"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0440\u0443\u0431\u0440\u0438\u043a\u0430\u0442\u043e\u0440\u0430 spros",eventAction:"\u0421\u043c\u0435\u043d\u0430 \u0440\u0435\u0433\u0438\u043e\u043d\u0430",eventLabel:"\u0412\u044b\u0437\u043e\u0432 \u043f\u043b\u0430\u0448\u043a\u0438 \u0432 H1"}),e(".js-firms-rubricator").length&&dataLayer.push({event:"GAevent",eventCategory:"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0440\u0443\u0431\u0440\u0438\u043a\u0430\u0442\u043e\u0440\u0430 firms",eventAction:"\u0421\u043c\u0435\u043d\u0430 \u0440\u0435\u0433\u0438\u043e\u043d\u0430",eventLabel:"\u0412\u044b\u0437\u043e\u0432 \u043f\u043b\u0430\u0448\u043a\u0438 \u0432 H1"}),e(".js-firms-list").length&&dataLayer.push({event:"GAevent",eventCategory:"\u041b\u0438\u0441\u0442\u0438\u043d\u0433 \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u0439",eventAction:"\u0421\u043c\u0435\u043d\u0430 \u0440\u0435\u0433\u0438\u043e\u043d\u0430",eventLabel:"\u0412\u044b\u0437\u043e\u0432 \u043f\u043b\u0430\u0448\u043a\u0438 \u0432 H1"}),e(".js-demands-page-ga").length&&dataLayer.push({event:"GAevent",eventCategory:"\u041b\u0438\u0441\u0442\u0438\u043d\u0433 \u0437\u0430\u043a\u0443\u043f\u043e\u043a",eventAction:"\u0421\u043c\u0435\u043d\u0430 \u0440\u0435\u0433\u0438\u043e\u043d\u0430",eventLabel:"\u0412\u044b\u0437\u043e\u0432 \u043f\u043b\u0430\u0448\u043a\u0438 \u0432 H1"}),e(".js-product-block").length&&dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u0421\u043c\u0435\u043d\u0430 \u0440\u0435\u0433\u0438\u043e\u043d\u0430",eventLabel:"\u0412\u044b\u0437\u043e\u0432 \u043f\u043b\u0430\u0448\u043a\u0438 \u0432 H1"})}),$doc.on("showRecentRubricProducts",function(){e(".js-paid-products-list-cover .js-more-span-listing-ga").click(function(){dataLayer.push({event:"Event_1175"})})}),e(".js-region-link").click(function(){dataLayer.push({event:"GAevent",eventCategory:"\u041b\u0438\u0441\u0442\u0438\u043d\u0433 \u0442\u043e\u0432\u0430\u0440\u043e\u0432",eventAction:"\u041f\u0435\u0440\u0435\u0445\u043e\u0434 \u043d\u0430 \u0440\u0435\u0433\u0438\u043e\u043d \u0438\u0437 \u043b\u0438\u0441\u0442\u0438\u043d\u0433\u0430 \u0441\u0442\u0440\u0430\u043d\u044b \u0432 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0435"})}),$doc.on("click",".js-paid-products-list-cover [data-dir]",function(){dataLayer.push({event:"Event_1183"})}),e(".js-company-block .js-callback-link").click(function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u041f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a",eventLabel:"\u041a\u043b\u0438\u043a \u043f\u043e \u041f\u0435\u0440\u0435\u0437\u0432\u043e\u043d\u0438\u0442\u0435 \u043c\u043d\u0435"})}),$doc.on("click",".js-similiar-in-region .js-sp-more-link",function(){dataLayer.push({event:"Event_1187"})}).on("click",'.js-similiar-in-region [data-dir="next"]',function(){dataLayer.push({event:"Event_1188"})}).on("click",".js-similiar-in-region .js-similiar-img",function(){dataLayer.push({event:"Event_1138"})}).on("click",".js-similiar-in-region .js-similiar-product-name",function(){dataLayer.push({event:"Event_1137"})}).on("click",".js-similiar-with-discount .js-similiar-img",function(){dataLayer.push({event:"Event_1140"})}).on("click",".js-similiar-with-discount .js-similiar-product-name",function(){dataLayer.push({event:"Event_1139"})}).on("click",'.js-similiar-in-company [data-dir="next"]',function(){dataLayer.push({event:"Event_1186"})}).on("click",".js-similiar-in-company .js-sp-more-link",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u0422\u043e\u0432\u0430\u0440\u044b \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a\u0430",eventLabel:"\u041a\u043b\u0438\u043a \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435 \u0421\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0432\u0441\u0435"})}).on("click",".js-similiar-in-company .js-similiar-img",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u0422\u043e\u0432\u0430\u0440\u044b \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a\u0430",eventLabel:"\u041a\u043b\u0438\u043a \u043f\u043e \u0444\u043e\u0442\u043e \u0442\u043e\u0432\u0430\u0440\u0430"})}).on("click",".js-similiar-in-company .js-similiar-product-name",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u0422\u043e\u0432\u0430\u0440\u044b \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a\u0430",eventLabel:"\u041a\u043b\u0438\u043a \u043f\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e \u0442\u043e\u0432\u0430\u0440\u0430"})}),$doc.on("phonePopup.showAllContacts",function(){var t;e(".js-product-block").length&&(t=1194),e(".js-firms-list").length&&(t=1195),t&&dataLayer.push({event:"Event_"+t})}),e(".js-ppic-link").click(function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430 \u043d\u0430 \u0421\u041a",eventAction:"\u041a\u043b\u0438\u043a \u043f\u043e \u0444\u043e\u0442\u043e \u0442\u043e\u0432\u0430\u0440\u0430"})}),$doc.on("share:yandexShare",function(){dataLayer.push({event:"Event_1196"})}),$doc.on("click",".full-screen-gallery .fsgfl-item",function(){dataLayer.push({event:"Event_1197"})}),$doc.on("click",".fsg-body",function(){dataLayer.push({event:"Event_1198"})}),$doc.on("click",".full-screen-gallery [data-dir]",function(){dataLayer.push({event:"Event_1199"})}),$doc.on("click",".js-cl-anchor",function(){dataLayer.push({event:"Event_1221"})}),$win.scroll(function(){var t=$win.scrollTop()+$win.height(),r=e(".js-first-contact"),s=e(".js-apb-descr"),l=e(".js-sp-list"),c=e(".js-f-container .fci-item");e(".js-product-block").length&&(r.length&&t>=r.offset().top&&!n&&(dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u043b\u043e\u043a\u0430",eventLabel:"\u041f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a"}),n=!0),s.length&&t>=s.offset().top&&!i&&(dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u043b\u043e\u043a\u0430",eventLabel:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u0430"}),i=!0),l.length&&t>=l.eq(0).offset().top&&!a&&(dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u043b\u043e\u043a\u0430",eventLabel:"\u041f\u043e\u0445\u043e\u0436\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u044b"}),a=!0),
c.length&&t>=c.eq(0).offset().top&&!o&&(dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0431\u043b\u043e\u043a\u0430",eventLabel:"\u0424\u0443\u0442\u0435\u0440"}),o=!0))}),$doc.on("publicProductFree.load",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u0411\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u044b\u0439 \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a",eventLabel:"\u041f\u0443\u0431\u043b\u0438\u043a\u0443\u0435\u043c\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430",eventNonInteraction:"true"})}),$doc.on("archivedProductFree.load",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u0411\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u044b\u0439 \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a",eventLabel:"\u0410\u0440\u0445\u0438\u0432\u043d\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430",eventNonInteraction:"true"})}),$doc.on("deletedProductFree.load",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u0411\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u044b\u0439 \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a",eventLabel:"\u0423\u0434\u0430\u043b\u0451\u043d\u043d\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430",eventNonInteraction:"true"})}),$doc.on("publicProductPaid.load",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u041f\u043b\u0430\u0442\u043d\u044b\u0439 \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a",eventLabel:"\u041f\u0443\u0431\u043b\u0438\u043a\u0443\u0435\u043c\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430",eventNonInteraction:"true"})}),$doc.on("archivedProductPaid.load",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u041f\u043b\u0430\u0442\u043d\u044b\u0439 \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a",eventLabel:"\u0410\u0440\u0445\u0438\u0432\u043d\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430",eventNonInteraction:"true"})}),$doc.on("deletedProductPaid.load",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u041f\u043b\u0430\u0442\u043d\u044b\u0439 \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a",eventLabel:"\u0423\u0434\u0430\u043b\u0451\u043d\u043d\u0430\u044f \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0430",eventNonInteraction:"true"})}),$doc.on("click",".js-pplch-link, .js-arrow-link-goods",function(){dataLayer.push({event:"GAevent",eventCategory:"\u041a\u0430\u0440\u0442\u043e\u0447\u043a\u0430 \u0442\u043e\u0432\u0430\u0440\u0430",eventAction:"\u0422\u043e\u0432\u0430\u0440\u044b \u043f\u043b\u0430\u0442\u043d\u044b\u0445 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432",eventLabel:"\u041f\u0435\u0440\u0435\u0445\u043e\u0434 \u0432 \u0440\u0443\u0431\u0440\u0438\u043a\u0443 \u0442\u043e\u0432\u0430\u0440\u0430"})}),$doc.on("click",".js-company-path a",function(){dataLayer.push({event:"Event_1123"})}),$doc.on("click",".js-order-button-main-page",function(){dataLayer.push({event:"GAevent",eventCategory:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f \u0421\u041a",eventAction:"\u041a\u043d\u043e\u043f\u043a\u0430 \u0417\u0430\u043a\u0430\u0437\u0430\u0442\u044c"})}),$doc.on("click",".js-click-show-facets",function(){dataLayer.push({event:"Event_1229"})}),e(".js-f-name").click(function(){if(e(this).hasClass("pressed"))return!1;dataLayer.push({event:"GAevent",eventCategory:"\u041b\u0438\u0441\u0442\u0438\u043d\u0433 \u0442\u043e\u0432\u0430\u0440\u043e\u0432",eventAction:"\u0420\u0443\u0431\u0440\u0438\u043a\u0430\u0442\u043e\u0440",eventLabel:"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0444\u0430\u0441\u0435\u0442\u0430"})}),$doc.on("selectSearchItem",function(){dataLayer.push({event:"Event_1234"})}),$doc.on("click",".js-yandex-ad-portal-card-short a",function(){dataLayer.push({event:"Event_1236"})}),$doc.on("click",".js-yandex-ad-portal-card a",function(){dataLayer.push({event:"Event_1237"})}),e(".js-mark-as-read:enabled").click(function(){dataLayer.push({event:"Event_1242"})}),$doc.on("click",".phone-popup",function(t){var n,i=e(t.target);i.closest(".js-vcard-ga").length&&(n=1250),i.closest(".js-address-ga").length&&(n=1251),i.closest(".js-footer-ga").length&&(n=1252),n&&dataLayer.push({event:"Event_"+n})}),$doc.on("change",".js-upload-input",function(){dataLayer.push({event:"Event_1253"})}).on("uploadWithDND:Eti",function(){dataLayer.push({event:"Event_1256"})});var s=e.cookie("registration");s&&(dataLayer.push({event:"GAevent",eventCategory:"CMS content",eventAction:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u0438",eventLabel:s}),e.cookie("registration",null,{path:"/",domain:app.config.mainHost.replace("www","")})),e(".js-rubric-select").on("click",".list .go-link",function(){dataLayer.push({event:"Event_1094"})}),e(".js-suggested-rubrics-wrapper").on("click",".src-link",function(){var t=e(this).parent(".js-suggested-rubric").index(),n=0===t&&1095||1===t&&1096||2===t&&1097||3===t&&1098||4===t&&1099||5===t&&1259;dataLayer.push({event:"Event_"+n})}),e(".js-rubric-found").on("click",".js-src-link",function(){dataLayer.push({event:"Event_1093"})}),e(".js-wrapper-search-rubric").on("click",".js-select-manual",function(){dataLayer.push({event:"Event_1290"})}),$doc.on("change-product:comparison",function(t,n,i,a){var o;i!==undefined&&(e(".js-product-card-page-sk").length&&(o=a?"1314":"1312"),e(".js-product-card-page").length&&(o=a?"1219":"1220"),o&&dataLayer.push({event:"Event_"+o}))}).on("rejectOrder:orderCard",function(t,n){var i="tender"===e("#order-card").data("order-type")?app.config.gaIds["PC4-17238-2"]:1331;"seller"===n&&dataLayer.push({event:"Event_"+i})}).on("addNote:orderCard",function(e,t){"seller"===t&&dataLayer.push({event:"Event_1332"})}),e(".js-product-card-page-sk").on("click",".js-compare-link",function(){dataLayer.push({event:"Event_1313"})})}(jQuery)};var Upscroll=function(){function e(){var e=$(".js-product-block-fixed");return!!e.length&&{$elem:e,condition:function(){return!e.hasClass("simple")&&e.offset().top<=i.$bottomBlock.offset().top}}}var t,n,i={arrowClass:"up-scroll-arrow-flat",$block:$(".js-products-list"),side:"left",marginFromBlock:207,$bottomBlock:$(".js-f-container"),bottomMargin:50,$leftColumn:$(".col-left"),topMargin:20,scrollPeriod:200,title:"\u043d\u0430\u0432\u0435\u0440\u0445",titleClass:"usa-title",bottomModifier:e()},a=function(){$("body").append($("<div>").addClass(i.arrowClass)),t=$("."+i.arrowClass).html($("<div>").addClass(i.titleClass).text(i.title)).css({position:"fixed",bottom:i.bottomMargin})},o=function(){var e,a,o=i.$block.offset(),r=t.outerWidth(),s={leftMargin:-i.marginFromBlock-r,rightMargin:i.marginFromBlock},l=i.$block.outerWidth(),c=$win.height(),d=i.$bottomBlock.offset().top-$win.scrollTop(),u=!!i.bottomModifier&&i.bottomModifier.condition(),p=i.bottomModifier&&i.bottomModifier.$elem.outerHeight();"left"===i.side?(a=o.left-r-i.marginFromBlock>=10,e=o.left+(a?s.leftMargin:s.rightMargin)):(a=o.left+l+i.marginFromBlock+r+10<=$win.width(),e=o.left+l+(a?s.rightMargin:s.leftMargin)),n=d+(!$body.hasClass("js-company-page")&&u&&p)<c?c-d+i.bottomMargin:i.bottomMargin,u&&(n+=p),t.css({left:e,bottom:n})},r=function(){var e=$win.scrollTop(),a=i.$leftColumn.length&&i.$leftColumn.outerHeight()+i.$leftColumn.offset().top-$win.height()+n+t.outerHeight()+i.topMargin,o=e>=$win.height()/2;return i.$leftColumn.length?e>=a&&o:o},s=function(){r()&&!$(".stretched-column").length?(t.addClass("visible"),o()):t.removeClass("visible")},l=function(){t.on("click",function(){$("body, html").animate({scrollTop:0},i.scrollPeriod),$doc.trigger("scroll:UpscrollArrow")}),$win.on("scroll",s),$win.on("resize",o),$doc.on("clickVerticalRubricsTree clickCatalogueRubricsTree rubricsItemsLoaded.catalogueRubricsTree rubricsItemsLoaded.verticalRubricsTree",s),$doc.on("loadItemsSuccess.infinityLoad",o)},c=function(){i.$block.length&&(a(),o(),s(),l())};return{init:function(e){$.extend(i,e),c()}}}();(function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["user_favorites/move_to_group_popup"]=Handlebars.template({1:function(){return"disabled"},3:function(){return"  <div class='scp-section'>\n    <a href='#' class='js-show-dynamic-auth-component'>\u0412\u043e\u0439\u0434\u0438\u0442\u0435</a> \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u0433\u0440\u0443\u043f\u043f\u044b\n  </div>\n"},5:function(e,t,n,i){var a;return"  <div class='scp-section'>\n    <ul class='scp-list js-fgw-list-items'>\n      <li class='scp-list-item js-favorite-group-item' data-slug='0'>\n        \u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435\n      </li>\n"+(null!=(a=t.each.call(e,null!=e?e.groups:e,{name:"each",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?a:"")+"    </ul>\n  </div>\n  <div class='scp-section action-panel'>\n"+(null!=(a=t["if"].call(e,null!=e?e.canCreateGroup:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.program(10,i,0),data:i}))?a:"")+"    <div class='scp-row'>\n"+(null!=(a=t["if"].call(e,null!=e?e.canCreateGroup:e,{name:"if",hash:{},fn:this.program(15,i,0),inverse:this.program(17,i,0),data:i}))?a:"")+"    </div>\n    <div class='scp-row button'>\n      <button class='custom-button js-create-favorite-group'>Co\u0445\u0440\u0430\u043d\u0438\u0442\u044c</button>\n    </div>\n  </div>\n"},6:function(e){return"      <li class='scp-list-item js-favorite-group-item' data-slug='"+this.escapeExpression(this.lambda(null!=e?e.slug:e,e))+"'>"+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</li>\n"},8:function(){return"    <div class='scp-row header'>\n      \u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443:\n    </div>\n"},10:function(e,t,n,i){var a;return(null!=(a=t.unless.call(e,null!=e?e.companySelected:e,{name:"unless",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?a:"")+(null!=(a=t["if"].call(e,null!=e?e.maxGroupsCountReached:e,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?a:"")},11:function(){return"    <div class='scp-row'>\n      <div class='scp-error'>\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u043e\u0441\u0442\u0430\u0432\u0449\u0438\u043a\u043e\u0432 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430</div>\n    </div>\n"},13:function(){return"    <div class='scp-row'>\n      <div class='scp-error'>\u041c\u043e\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u0435 \u0431\u043e\u043b\u0435\u0435 100 \u0433\u0440\u0443\u043f\u043f</div>\n    </div>\n"},15:function(){return"      <input class='scp-input js-favorite-group-input' maxlength='35'>\n      <div class='scp-error js-favorite-group-error'></div>\n"},17:function(){return"      <input class='scp-input' disabled>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"<div class='select-create-popup dropdown js-favorite-group-window "+(null!=(a=t.unless.call(e,null!=e?e.companySelected:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+'\' data-errors=\'{"required":"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b","unique":"\u0413\u0440\u0443\u043f\u043f\u0430 \u0441 \u0442\u0430\u043a\u0438\u043c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435\u043c \u0443\u0436\u0435 \u0435\u0441\u0442\u044c","invalid-title":"\u0413\u0440\u0443\u043f\u043f\u0430 \u0441 \u0442\u0430\u043a\u0438\u043c \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435\u043c \u0443\u0436\u0435 \u0435\u0441\u0442\u044c"}\'>\n'+(null!=(a=t["if"].call(e,null!=e?e.isForbidden:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.program(5,i,0),data:i}))?a:"")+"</div>"},useData:!0}),this.HandlebarsTemplates["user_favorites/move_to_group_popup"]}).call(this),function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["user_favorites/note_editor_panel"]=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(){return"<div class='note-editor-panel js-note-editor-panel'>\n  <div class='nep-row'>\n    <div class='js-note-editor-field-wrapper'>\n      <textarea class='nep-field js-note-editor-panel-field js-length-check' maxlength='1000' placeholder='\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u043c\u0435\u0442\u043a\u0443'></textarea>\n    </div>\n    <div class='nep-counter js-note-editor-panel-counter'>\n      \u041e\u0441\u0442\u0430\u043b\u043e\u0441\u044c \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432:\n      <span></span>\n    </div>\n  </div>\n  <div class='nep-row'>\n    <button class='original-button js-note-editor-panel-button'>\n      \u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c\n    </button>\n  </div>\n</div>"},useData:!0}),this.HandlebarsTemplates["user_favorites/note_editor_panel"]}.call(this),favoriteGroups=[],favoriteGroupsLimit={count:0,limit:100},app.modules.userFavorites=app.modules.userFavorites||{},app.modules.userFavorites.load=function(){hideFavoritesCompanies(),eventListener()};var RatingTooltip=function(e){var t,n,i,a={elClassName:"js-rank-row",tooltipClassName:"rating-tooltip",topDiff:0},o=function(){t=e("<div>").addClass(a.tooltipClassName).appendTo("body")},r=function(){t.show(),setTimeout(function(){t.css({opacity:1})},20),$doc.trigger("show.ratingTooltip")},s=function(){t.html(n.data("text")+" ").append(e("<a>").attr({href:n.data("url"),target:"_blank"}).addClass("js-rating-tooltip-link").text(n.data("packet")))},l=function(){$doc.on("show.ratingTooltip",function(){$doc.on("mousemove.ratingTooltip",function(a){var o=n.offset(),r=a.pageX,s=a.pageY;(r<Math.floor(o.left)||r>o.left+i.width()+t.outerWidth()||s<o.top-(e(".js-price-firms-new").length?30:20)||s>o.top+i.outerHeight()+20)&&(t.hide().css("opacity",0),$doc.trigger("hide.ratingTooltip"))})}),$doc.on("hide.ratingTooltip",function(){$doc.off("mousemove.ratingTooltip")}),$doc.on("click","."+a.tooltipClassName,u)},c=function(){$doc.on("mouseenter","."+a.elClassName,function(){n=e(this),e("."+a.tooltipClassName).length||o(),r(),s(),d()}),l()},d=function(){var e=n.offset(),i=t.outerWidth(),o=$win.width(),r=n.width()+e.left,s=(r+i>=o?o-i:r)-10;t.css({top:e.top-t.outerHeight()-(a.topDiff?a.topDiff:0),left:s})},u=function(){t&&t.hide().css("opacity",0)},p=function(){i=e("."+a.elClassName),c()};return{init:function(t){e.extend(a,t),p()},hide:function(){u()}}}(jQuery);!function(e){var t,n={},i=!1,a={min:0,max:100,minRange:0,maxRange:100,step:"auto",classMinArrow:"min-arrow",classMaxArrow:"max-arrow",classRange:"slider-range",classSlider:"slider",classUnselect:"slider-unselect",classTags:"slider-tags",classMark:"slider-mark",showMarks:!0,tagPrefix:"",tagSuffix:""},o=function(e){var n=0,i=document.documentElement;return null!=document.attachEvent?n=window.event.clientX+(i.scrollLeft||document.body.scrollLeft):!document.attachEvent&&document.addEventListener&&(n=e.clientX+window.scrollX),n-=t.parent().offset().left,{x:n}},r=function(e,n){var i=n||t.parent();return i.data("options").tagPrefix+e+i.data("options").tagSuffix},s=function(e){var n,i=t.parent(),a=i.width(),r=i.find(".js-tags-min"),s=i.find(".js-tags-max"),l=i.find(".js-arrow-min"),c=i.find(".js-arrow-max"),d=i.find(".js-unselect-min"),u=i.find(".js-unselect-max"),p=o(e).x;p=Math.min(p,a),p=Math.max(p,0),"min"==t.data("arrow")&&(p=Math.min(p,c.data("x")),d.css({left:0,width:p?p-1:0}),l.data("x",p),c.css("z-index",10),n=i.find(".js-tags-min"),t.css({left:p+"px","z-index":100})),"max"==t.data("arrow")&&(p=Math.max(p,l.data("x")),u.css({left:p,width:a-p}),c.data("x",p),l.css("z-index",10),n=i.find(".js-tags-max"),t.css({right:a-p+"px","z-index":100})),"round"==i.data("options").step?_setValueRound(n,p,a):_setValue(n,parseInt(i.data("options").max/a*p)),i.data("options").changeValue&&i.data("options").changeValue({min:r.data("value"),max:s.data("value")})};_setMovedArrow=function(e,n){i=!0,t=e.data("arrow",n)},_setValue=function(e,t){e.data("value",t).html(r(t))},_setValueRound=function(e,n,i){var a,o=0,r=t.parent();n&&(o=parseInt(r.data("options").max/i*n),a=Math.pow(10,Math.floor(Math.log(o)/Math.LN10-1)),o=0==a?0:Math.floor(o/a)*a),_setValue(e,o)},_clickSlider=function(t){var n,a=e(this).parent(),r=a.find(".js-arrow-min"),l=a.find(".js-arrow-max");_setMovedArrow(r,"min"),n=o(t).x,Math.abs(n-parseInt(l.data("x")))<Math.abs(n-parseInt(r.data("x")))&&_setMovedArrow(l,"max"),i=!1,s(t)},_create=function(t){t.each(function(){var t,i,a,o=e(this).data("options",e.extend({},n)),s=o.width(),l=(parseInt(o.data("options").maxRange)-parseInt(o.data("options").minRange))/o.data("options").max*s,c=e("<div>").addClass(o.data("options").classMinArrow+" js-arrow-min").css({left:0}).data("x",0),d=e("<div>").addClass(o.data("options").classMaxArrow+" js-arrow-max").css({right:0}).data("x",s),u=e("<div>").addClass(o.data("options").classUnselect+" js-unselect-min").css({left:0,width:0}).click(_clickSlider),p=e("<div>").addClass(o.data("options").classUnselect+" js-unselect-max").css({left:s,width:0}).click(_clickSlider),f=e("<div>").addClass(o.data("options").classRange+" js-range").width(l).css("left",o.data("options").minRange/o.data("options").max*s+"px").click(_clickSlider),h=e("<div>").addClass(o.data("options").classSlider+" js-slider").width(s).click(_clickSlider),m=e("<div>").addClass("js-tags-min").css({position:"absolute",left:0}).html(r(o.data("options").min,o)).data({value:o.data("options").min,type:"min"}),g=e("<div>").addClass("js-tags-max").css({position:"absolute",right:0}).html(r(o.data("options").max,o)).data({value:o.data("options").max,type:"max"}),v=e("<div>").addClass(o.data("options").classTags).width(s).append(m,g);o.data("options").showMarks?(t=e("<div>").addClass(o.data("options").classMark).css({"margin-left":-1,left:0}),i=e("<div>").addClass(o.data("options").classMark).css({left:s}),a=e("<div>").addClass(o.data("options").classMark).css({left:s/2}),o.append(t,i,a,h,f,c,d,u,p,v)):o.append(h,f,c,d,u,p,v),c.mousedown(function(){return _setMovedArrow(e(this),"min"),!1}),d.mousedown(function(){return _setMovedArrow(e(this),"max"),!1})})},_methods={init:function(t){e.extend(n,a,t),_create(this),e(document).on("mouseup",function(){i=!1}),e(document).on("mousemove",function(e){if(i)return s(e),!1})},setRange:function(e){var t=this.width(),n=this.find(".js-range");n.width((parseInt(e.max)-parseInt(e.min))/this.data("options").max*t),n.css("left",e.min/this.data("options").max*t+"px")},getValue:function(){var e=this.find(".js-tags-min"),t=this.find(".js-tags-max");return{min:e.data("value"),max:t.data("value")}}},e.fn.sliderRange=function(t){return _methods[t]?_methods[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("\u041c\u0435\u0442\u043e\u0434 "+t+" \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 jQuery.sliderRange"):_methods.init.apply(this,arguments)}}(jQuery),function(e){function t(){this.initialize.apply(this,arguments)}function n(n,i,o){function r(e,t,n,i,a){var o=Math.round(i/1.7320508);t.inactive()["setBorder"+n.camel.pos.f](i)["setBorder"+n.camel.pos.c1](o)["setBorder"+n.camel.pos.c2](o)["set"+n.camel.pos.p1](n.isTopLeft?-i:e.inner[n.size.p])["set"+n.camel.pos.c1](e.inner[n.size.c]/2-o).active().$.css("border-"+n.pos.f+"-color",a)}i.stop(!0,!0);var s,l,c={position:"absolute",height:"0",width:"0",border:"solid 0 transparent"},d=new t(n),u=new t(i);if(u.setTop(-o.offsetY+(o.position&&o.position.indexOf("top")>=0?d.top-u.height:o.position&&o.position.indexOf("bottom")>=0?d.bottom:d.center.top-u.height/2)),u.setLeft(o.offsetX+(o.position&&o.position.indexOf("left")>=0?d.left-u.width:o.position&&o.position.indexOf("right")>=0?d.right:d.center.left-u.width/2)),o.tipSize>0){i.data("outerTip")&&(i.data("outerTip").remove(),i.removeData("outerTip")),i.data("innerTip")&&(i.data("innerTip").remove(),i.removeData("innerTip")),s=new t(e("<div>").css(c).appendTo(i)),l=new t(e("<div>").css(c).appendTo(i));for(var p,f=0;f<a.pos.length;f++){if(p=a.getRelativeNames(f),u.center[p.pos.c1]>=d[p.pos.c1]&&u.center[p.pos.c1]<=d[p.pos.c2])if(f%2==0){if(u[p.pos.o]>=d[p.pos.o]&&u[p.pos.f]>=d[p.pos.f])break}else if(u[p.pos.o]<=d[p.pos.o]&&u[p.pos.f]<=d[p.pos.f])break;p=null}p?(u["set"+p.camel.pos.p1](u[p.pos.p1]+(p.isTopLeft?1:-1)*(o.tipSize-u["border"+p.camel.pos.o])),r(u,s,p,o.tipSize,i.css("border-"+p.pos.o+"-color")),r(u,l,p,o.tipSize-2*u["border"+p.camel.pos.o],i.css("background-color")),i.data("outerTip",s.$).data("innerTip",l.$)):e.each([s.$,l.$],function(){this.remove()})}}function i(t,n){var i=t.data("balloon")&&t.data("balloon").get(0);return!(i&&(i==n.relatedTarget||e.contains(i,n.relatedTarget)))}var a={};a.pos=e.extend(["top","bottom","left","right"],{camel:["Top","Bottom","Left","Right"]}),a.size=e.extend(["height","width"],{camel:["Height","Width"]}),a.getRelativeNames=function(e){var t={pos:{o:e,f:e%2==0?e+1:e-1,p1:e%2==0?e:e-1,p2:e%2==0?e+1:e,c1:e<2?2:0,c2:e<2?3:1},size:{p:e<2?0:1,c:e<2?1:0}},n={};for(var i in t){n[i]||(n[i]={});for(var o in t[i])n[i][o]=a[i][t[i][o]],n.camel||(n.camel={}),n.camel[i]||(n.camel[i]={}),n.camel[i][o]=a[i].camel[t[i][o]]}return n.isTopLeft=n.pos.o==n.pos.p1,n},function(){function n(e,t){if(t==undefined)return n(e,!0),n(e,!1);var i=a.getRelativeNames(t?0:2);return e[i.size.p]=e.$["outer"+i.camel.size.p](),e[i.pos.f]=e[i.pos.o]+e[i.size.p],e.center[i.pos.o]=e[i.pos.o]+e[i.size.p]/2,e.inner[i.pos.o]=e[i.pos.o]+e["border"+i.camel.pos.o],e.inner[i.size.p]=e.$["inner"+i.camel.size.p](),e.inner[i.pos.f]=e.inner[i.pos.o]+e.inner[i.size.p],e.inner.center[i.pos.o]=e.inner[i.pos.f]+e.inner[i.size.p]/2,e}var i={setBorder:function(e,t){return function(i){return this.$.css("border-"+e.toLowerCase()+"-width",i+"px"),this["border"+e]=i,this.isActive?n(this,t):this}},setPosition:function(e,t){return function(i){return this.$.css(e.toLowerCase(),i+"px"),this[e.toLowerCase()]=i,this.isActive?n(this,t):this}}};t.prototype={initialize:function(t){this.$=t,e.extend(!0,this,this.$.offset(),{center:{},inner:{center:{}}});for(var n=0;n<a.pos.length;n++)this["border"+a.pos.camel[n]]=parseInt(this.$.css("border-"+a.pos[n]+"-width"))||0;this.active()},active:function(){return this.isActive=!0,n(this),this},inactive:function(){return this.isActive=!1,this}};for(var o=0;o<a.pos.length;o++)t.prototype["setBorder"+a.pos.camel[o]]=i.setBorder(a.pos.camel[o],o<2),o%2==0&&(t.prototype["set"+a.pos.camel[o]]=i.setPosition(a.pos.camel[o],o<2))}(),e.fn.balloon=function(t){return t=e.extend(!0,{},e.balloon.defaults,t),this.one("mouseenter",function(){var n=e(this),a=this,o=n.unbind("mouseenter",arguments.callee).showBalloon(t).mouseenter(function(e){i(n,e)&&n.showBalloon()}).data("balloon");o&&o.mouseleave(function(t){a==t.relatedTarget||e.contains(a,t.relatedTarget)||n.hideBalloon()}).mouseenter(function(){n.showBalloon()})}).mouseleave(function(t){var n=e(this);i(n,t)&&n.hideBalloon()})},e.fn.showBalloon=function(t){var i,a,o;return e.balloon.defaults.css||(e.balloon.defaults.css={}),!t&&this.data("options")||this.data("options",e.extend(!0,{},e.balloon.defaults,t)),t=this.data("options"),this.each(function(){i=e(this),(o=i.data("offTimer"))&&clearTimeout(o);var r=e.isFunction(t.contents)?t.contents():t.contents||i.attr("title"),s=!(a=i.data("balloon"));s&&(a=e("<div>").append(r)),(t.url||a&&""!=a.html())&&(!s&&r&&r!=a.html()&&a.empty().append(r),i.removeAttr("title"),t.url&&a.load(e.isFunction(t.url)?t.url(this):t.url,function(e,o,r){t.ajaxComplete&&t.ajaxComplete(e,o,r),n(i,a,t)}),s?(a.addClass(t.classname).css(t.css).css({visibility:"hidden",position:"absolute"}).appendTo("body"),i.data("balloon",a),n(i,a,t),a.hide().css("visibility","visible")):n(i,a,t),i.data("onTimer",setTimeout(function(){t.showAnimation?t.showAnimation.apply(a.stop(!0,!0),[t.showDuration]):a.show(t.showDuration,function(){this.style.removeAttribute&&this.style.removeAttribute("filter")})},t.delay)))})},e.fn.hideBalloon=function(){var t,n,i=this.data("options");return this.each(function(){var a=e(this);(t=a.data("onTimer"))&&clearTimeout(t),(n=a.data("offTimer"))&&clearTimeout(n),a.data("offTimer",setTimeout(function(){var e=a.data("balloon");i.hideAnimation?e&&i.hideAnimation.apply(e.stop(!0,!0),[i.hideDuration]):e&&e.stop(!0,!0).hide(i.hideDuration)},i.minLifetime))})},e.balloon={defaults:{contents:null,url:null,ajaxComplete:null,classname:null,position:"top",offsetX:0,offsetY:0,tipSize:12,delay:0,minLifetime:200,showDuration:100,showAnimation:null,hideDuration:80,hideAnimation:function(e){this.fadeOut(e)},css:{minWidth:"20px",padding:"5px",borderRadius:"6px",border:"solid 1px #777",boxShadow:"4px 4px 4px #555",color:"#666",backgroundColor:"#efefef",opacity:e.support.opacity?"0.85":null,zIndex:"2070",textAlign:"left"}}}}(jQuery),function(e){function t(t){var n=t||window.event,i=[].slice.call(arguments,1),a=0,o=0,r=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(a=n.wheelDelta/120),n.detail&&(a=-n.detail/3),r=a,n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS&&(r=0,o=-1*a),n.wheelDeltaY!==undefined&&(r=n.wheelDeltaY/120),n.wheelDeltaX!==undefined&&(o=-1*n.wheelDeltaX/120),i.unshift(t,a,o,r),(e.event.dispatch||e.event.handle).apply(this,i)}var n=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var i=n.length;i;)e.event.fixHooks[n[--i]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=n.length;e;)this.addEventListener(n[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=n.length;e;)this.removeEventListener(n[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery),function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["simple_breadcrumbs/popup"]=Handlebars.template({1:function(e,t,n,i){var a;return"    <li class='sbir-item'>\n      <a class='sbir-link link' href='"+this.escapeExpression(this.lambda(null!=e?e.html_listing_url:e,e))+"'>\n        <span>"+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</span>\n"+(null!=(a=t["if"].call(e,null!=e?e.isLink:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?a:"")+"      </a>\n    </li>\n"},2:function(){return"        <div class='sbirl-icon'></div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,o;return"<div class='sbi-rubrics-list js-rubrics-list'>\n  <div>\n    <a class='sbir-item with-rubrics' href='"+this.escapeExpression((o=null!=(o=t.url||(null!=e?e.url:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{name:"url",hash:{},data:i}):o))+"'>"+this.escapeExpression((o=null!=(o=t.name||(null!=e?e.name:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{name:"name",hash:{},data:i}):o))+"</a>\n  </div>\n  <ul>\n"+(null!=(a=t.each.call(e,null!=e?e.rubrics:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"  </ul>\n</div>"},useData:!0}),this.HandlebarsTemplates["simple_breadcrumbs/popup"]}.call(this),app.modules.simpleBreadcrumbs=function(e){function t(e){var t,o=e.data(),r=e.closest(".js-breadcrumb"),s=r.find(".js-rubrics-list");s.length?s.removeClass("dn"):$.ajax({url:e.data("load"),dataType:"json",success:function(e){((t=Array.isArray(e))&&e.length||e.hasOwnProperty("rubrics"))&&a(r.find(".js-rubrics-list-wrapper"),$.extend({name:o.crumb,url:o.url},t?n(e):i(e,o.rubric_id)))}}),r.siblings().find(".js-rubrics-list").addClass("dn")}function n(e){var t={rubrics:[]};return e.forEach(function(e){t.rubrics.push({title:e[0],html_listing_url:e[1],isLink:e[2]})}),t}function i(e,t){var n={rubrics:[]};return e.rubrics.forEach(function(e){e.id!==t&&n.rubrics.push(e)}),n}function a(e,t){e.html(HandlebarsTemplates["simple_breadcrumbs/popup"](t))}function o(){$doc.on("mouseenter touchend",".js-show-inner-rubrics",function(e){t($(this)),e.preventDefault()}).on("mouseleave",".js-rubrics-list",function(){$(this).addClass("dn")})}return e.load=function(){o()},e}(app.modules.simpleBreadcrumbs||{}),app.modules.sendUtmAnalytics=function(e){function t(){return location.search.substring(1).split("&").reduce(function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{})}function n(e,t){return e.reduce(function(e,n,i){return e[n]=t[i],e},{})}function i(e,t){var i={};return $.each(t,function(t,a){if(0===String(a).lastIndexOf("utm_")){if(!(a=e[a]))return;if(-1!==String(t).indexOf("&")&&-1!==String(a).indexOf("_"))return $.extend(i,n(t.split("&"),a.split("_")))}i[t]=a}),t.requiredParams&&$.each(t.requiredParams,function(e,t){i[t]||(i[t]=0)}),i}function a(e,t){$.ajax({url:t,data:e,declineCredentials:e.declineCredentials})}function o(e,n){var o=t();$.each(e,function(e,t){o[t.utmActionPlace]===e&&a(i(o,t),n)})}function r(){$doc.on("send:utmAnalytics",function(e,t,n){o(t,n)})}return e.load=function(){r()},e}(app.modules.sendUtmAnalytics||{}),app.modules.utmAnalytics=function(e){var t={email:{utmActionPlace:"utm_medium","entity_id&dispatch_id&send_date":"utm_campaign","user_id&company_id":"utm_term",date:"utm_content",entity_type:"Apress::Notifications::Delivery",event:"follow",url:location.href,requiredParams:["user_id","company_id"]}};return e.load=function(){location.search&&app.config.analyticsCollectURL&&$doc.trigger("send:utmAnalytics",[t,app.config.analyticsCollectURL])},e}(app.modules.utmAnalytics||{}),function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=(n||a)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,r,s,l,c;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),o=new ArrayBuffer(t.length),r=new Uint8Array(o),s=0;s<t.length;s+=1)r[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([i?r:o],{type:l}):(c=new a,c.append(o),c.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,i){e(i&&t.toDataURL&&o?o(this.toDataURL(n,i)):this.mozGetAsFile("blob",n))}:t.toDataURL&&o&&(t.toBlob=function(e,t,n){e(o(this.toDataURL(t,n)))})),e.dataURLtoBlob=o}(window),function(e,t){"use strict";function n(e,t,n,i,a){var o={type:n.type||n,target:e,result:i};K(o,a),t(o)}function i(e){return C&&!!C.prototype["readAs"+e]}function a(e,a,o,r){if(ne.isBlob(e)&&i(o)){var s=new C;J(s,G,function t(i){var o=i.type;"progress"==o?n(e,a,i,i.target.result,{loaded:i.loaded,total:i.total}):"loadend"==o?(Y(s,G,t),s=null):n(e,a,i,i.target.result)});try{r?s["readAs"+o](e,r):s["readAs"+o](e)}catch(i){n(e,a,"error",t,{error:i.toString()})}}else n(e,a,"error",t,{error:"filreader_not_support_"+o})}function o(e,t){if(!e.type&&(w||e.size%4096==0&&e.size<=102400))if(C)try{var n=new C;Z(n,G,function(e){var i="error"!=e.type;i?(null!=n.readyState&&n.readyState!==n.LOADING||n.abort(),t(i)):t(!1,n.error)}),n.readAsDataURL(e)}catch(e){t(!1,e)}else t(null,new Error("FileReader is not supported"));else t(!0)}function r(e){return e&&(e.isFile||e.isDirectory)}function s(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function l(e,t){if(e)if(e.isFile)e.file(function(n){n.fullPath=e.fullPath,t(!1,[n],[n])},function(n){e.error=n,t("FileError.code: "+n.code,[],[e])});else if(e.isDirectory){var n=e.createReader(),i=!0,a=[],o=[e],r=function(n){e.error=n,t("DirectoryError.code: "+n.code,a,o)},c=function s(c){i&&(i=!1,c.length||(e.error=new Error("directory is empty"))),c.length?ne.afor(c,function(e,t){l(t,function(t,i,l){t||(a=a.concat(i)),o=o.concat(l),e?e():n.readEntries(s,r)})}):t(!1,a,o)};n.readEntries(c,r)}else l(s(e),t);else{var d=new Error("invalid entry");e=new Object(e),e.error=d,t(d.message,[],[e])}}function c(e){
var t={};return V(e,function(e,n){e&&"object"==typeof e&&void 0===e.nodeType&&(e=K({},e)),t[n]=e}),t}function d(e){return z.test(e&&e.tagName)}function u(e){return(e.originalEvent||e||"").dataTransfer||{}}function p(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||"overlay"===t||"filter"===t))return!0;return!1}var f,h,m=1,g=function(){},v=e.document,y=v.doctype||{},b=e.navigator.userAgent,w=/safari\//i.test(b)&&!/chrome\//i.test(b),x=/iemobile\//i.test(b),A=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,_=e.Blob,j=e.File,C=e.FileReader,F=e.FormData,k=e.XMLHttpRequest,$=e.jQuery,T=!(!(j&&C&&(e.Uint8Array||F||k.prototype.sendAsBinary))||w&&/windows/i.test(b)&&!x),I=T&&"withCredentials"in new k,L=T&&!!_&&!!(_.prototype.webkitSlice||_.prototype.mozSlice||_.prototype.slice),R=(""+"".normalize).indexOf("[native code]")>0,E=e.dataURLtoBlob,S=/img/i,D=/canvas/i,P=/img|canvas/i,z=/input/i,B=/^data:[^,]+,/,U={}.toString,M=e.Math,H=function(t){return t=new e.Number(M.pow(1024,t)),t.from=function(e){return M.round(e*this)},t},N={},O=[],G="abort progress error load loadend",q="status statusText readyState response responseXML responseText responseBody".split(" "),X="currentTarget",W="preventDefault",Q=function(e){return e&&"length"in e},V=function(e,t,n){if(e)if(Q(e))for(var i=0,a=e.length;i<a;i++)i in e&&t.call(n,e[i],i,e);else for(var o in e)e.hasOwnProperty(o)&&t.call(n,e[o],o,e)},K=function(e){for(var t=arguments,n=1,i=function(t,n){e[n]=t};n<t.length;n++)V(t[n],i);return e},J=function(e,t,n){if(e){var i=ne.uid(e);N[i]||(N[i]={});var a=C&&e&&e instanceof C;V(t.split(/\s+/),function(t){$&&!a?$.event.add(e,t,n):(N[i][t]||(N[i][t]=[]),N[i][t].push(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)})}},Y=function(e,t,n){if(e){var i=ne.uid(e),a=N[i]||{},o=C&&e&&e instanceof C;V(t.split(/\s+/),function(t){if($&&!o)$.event.remove(e,t,n);else{for(var i=a[t]||[],r=i.length;r--;)if(i[r]===n){i.splice(r,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}})}},Z=function(e,t,n){J(e,t,function i(a){Y(e,t,i),n(a)})},ee=function(t){return t.target||(t.target=e.event&&e.event.srcElement||v),3===t.target.nodeType&&(t.target=t.target.parentNode),t},te=function(e){var t=v.createElement("input");return t.setAttribute("type","file"),e in t},ne={version:"2.0.19",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(null!=t?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:H(1),MB:H(2),GB:H(3),TB:H(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[ne.expando]=e[ne.expando]||ne.uid():(++m,ne.expando+m)},log:function(){ne.debug&&f&&(h?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,t){var n=v.createElement("img");return t&&ne.event.one(n,"error load",function(e){t("error"==e.type,n),n=null}),n.src=e,n},getXHR:function(){var t;if(k)t=new k;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:Q,support:{dnd:I&&"ondrop"in v.createElement("div"),cors:I,html5:T,chunked:L,dataURI:!0,accept:te("accept"),multiple:te("multiple")},event:{on:J,off:Y,one:Z,fix:ee},throttle:function(t,n){var i,a;return function(){a=arguments,i||(t.apply(e,a),i=setTimeout(function(){i=0,t.apply(e,a)},n))}},F:function(){},parseJSON:function(t){return e.JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return e=String(e),e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e,n,i=[],a={resolve:function(t,o){for(a.resolve=g,n=t||!1,e=o;o=i.shift();)o(n,e)},then:function(a){n!==t?a(n,e):i.push(a)}};return a},queue:function(e){var t=0,n=0,i=!1,a=!1,o={inc:function(){n++},next:function(){t++,setTimeout(o.check,0)},check:function(){t>=n&&!i&&o.end()},isFail:function(){return i},fail:function(){!i&&e(i=!0)},end:function(){a||(a=!0,e())}};return o},each:V,afor:function(e,t){var n=0,i=e.length;Q(e)&&i--?function a(){t(i!=n&&a,e[n],n++)}():t(!1)},extend:K,isFile:function(e){return"[object File]"===U.call(e)},isBlob:function(e){return this.isFile(e)||"[object Blob]"===U.call(e)},isCanvas:function(e){return e&&D.test(e.nodeName)},getFilesFilter:function(e){return e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"",e?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){ne.isCanvas(e)?n(e,t,"load",ne.toDataURL(e)):a(e,t,"DataURL")},readAsBinaryString:function(e,t){i("BinaryString")?a(e,t,"BinaryString"):a(e,function(e){if("load"==e.type)try{e.result=ne.toBinaryString(e.result)}catch(t){e.type="error",e.message=t.toString()}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){a(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),a(e,n,"Text",t)},toDataURL:function(e,t){return"string"==typeof e?e:e.toDataURL?e.toDataURL(t||"image/png"):void 0},toBinaryString:function(t){return e.atob(ne.toDataURL(t).replace(B,""))},readAsImage:function(e,i,a){if(ne.isBlob(e))if(A){var o=A.createObjectURL(e);o===t?n(e,i,"error"):ne.readAsImage(o,i,a)}else ne.readAsDataURL(e,function(t){"load"==t.type?ne.readAsImage(t.result,i,a):(a||"error"==t.type)&&n(e,i,t,null,{loaded:t.loaded,total:t.total})});else if(ne.isCanvas(e))n(e,i,"load",e);else if(S.test(e.nodeName))if(e.complete)n(e,i,"load",e);else{var r="error abort load";Z(e,r,function t(a){"load"==a.type&&A&&A.revokeObjectURL(e.src),Y(e,r,t),n(e,i,a,e)})}else if(e.iframe)n(e,i,{type:"error"});else{var s=ne.newImage(e.dataURL||e);ne.readAsImage(s,i,a)}},checkFileObj:function(e){var t={},n=ne.accept;return"object"==typeof e?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),V(n,function(e,n){e=new RegExp(e.replace(/\s/g,"|"),"i"),(e.test(t.type)||ne.ext2mime[t.type])&&(t.type=ne.ext2mime[t.type]||n.split("/")[0]+"/"+t.type)}),t},getDropFiles:function(e,t){var n,i=[],a=[],c=u(e),d=c.files,p=c.items,f=Q(p)&&p[0]&&s(p[0]),h=ne.queue(function(){t(i,a)});if(f)if(R&&d){var m,g,v=d.length;for(n=new Array(v);v--;){m=d[v];try{g=s(p[v])}catch(e){ne.log("[err] getDropFiles: ",e),g=null}r(g)&&(g.isDirectory||g.isFile&&m.name==m.name.normalize("NFC"))?n[v]=g:n[v]=m}}else n=p;else n=d;V(n||[],function(e){h.inc();try{f&&r(e)?l(e,function(e,t,n){e?ne.log("[err] getDropFiles:",e):i.push.apply(i,t),a.push.apply(a,n),h.next()}):o(e,function(t,n){t?i.push(e):e.error=n,a.push(e),h.next()})}catch(e){h.next(),ne.log("[err] getDropFiles: ",e)}}),h.check()},getFiles:function(e,t,n){var i=[];return n?(ne.filterFiles(ne.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){i=i.concat(ne.getFiles(this))}),e=i,i=[]),"string"==typeof t&&(t=ne.getFilesFilter(t)),e.originalEvent?e=ee(e.originalEvent):e.srcElement&&(e=ee(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(i=e.files,T||(i[0].blob=e,i[0].iframe=!0)):!T&&d(e)?ne.trim(e.value)&&(i=[ne.checkFileObj(e.value)],i[0].blob=e,i[0].iframe=!0):Q(e)&&(i=e),ne.filter(i,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(e,t){var n={},i=O.concat();ne.isBlob(e)?function a(){var o=i.shift();o?o.test(e.type)?o(e,function(e,i){e?t(e):(K(n,i),a())}):a():t(!1,n)}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},O.push(t)},filter:function(e,t){for(var n,i=[],a=0,o=e.length;a<o;a++)a in e&&(n=e[a],t.call(n,n,a,e)&&i.push(n));return i},filterFiles:function(e,t,n){if(e.length){var i,a=e.concat(),o=[],r=[];!function e(){a.length?(i=a.shift(),ne.getInfo(i,function(n,a){(t(i,!n&&a)?o:r).push(i),e()})):n(o,r)}()}else n([],e)},upload:function(e){e=K({jsonp:"callback",prepare:ne.F,beforeupload:ne.F,upload:ne.F,fileupload:ne.F,fileprogress:ne.F,filecomplete:ne.F,progress:ne.F,complete:ne.F,pause:ne.F,imageOriginal:!0,chunkSize:ne.chunkSize,chunkUploadRetry:ne.chunkUploadRetry,uploadRetry:ne.uploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new ne.XHR(e),i=this._getFilesDataArray(e.files),a=this,o=0,r=0,s=!1;return V(i,function(e){o+=e.size}),n.files=[],V(i,function(e){n.files.push(e.file)}),n.total=o,n.loaded=0,n.filesLeft=i.length,e.beforeupload(n,e),t=function(){var l=i.shift(),d=l&&l.file,u=!1,p=c(e);if(n.filesLeft=i.length,d&&d.name===ne.expando&&(d=null,ne.log("[warn] FileAPI.upload() \u2014 called without files")),("abort"!=n.statusText||n.current)&&l){if(s=!1,n.currentFile=d,d&&!1===e.prepare(d,p))return void t.call(a);p.file=d,a._getFormData(p,l,function(s){r||e.upload(n,e);var c=new ne.XHR(K({},p,{upload:d?function(){e.fileupload(d,c,p)}:g,progress:d?function(t){u||(u=t.loaded===t.total,e.fileprogress({type:"progress",total:l.total=t.total,loaded:l.loaded=t.loaded},d,c,p),e.progress({type:"progress",total:o,loaded:n.loaded=r+l.size*(t.loaded/t.total)||0},d,c,p))}:g,complete:function(i){V(q,function(e){n[e]=c[e]}),d&&(l.total=l.total||l.size,l.loaded=l.total,i||(this.progress(l),u=!0,r+=l.size,n.loaded=r),e.filecomplete(i,c,d,p)),setTimeout(function(){t.call(a)},0)}}));n.abort=function(e){e||(i.length=0),this.current=e,c.abort()},c.send(s)})}else{var f=200==n.status||201==n.status||204==n.status;e.complete(!f&&(n.statusText||"error"),n,e),s=!0}},setTimeout(t,0),n.append=function(e,r){e=ne._getFilesDataArray([].concat(e)),V(e,function(e){o+=e.size,n.files.push(e.file),r?i.unshift(e):i.push(e)}),n.statusText="",s&&t.call(a)},n.remove=function(e){for(var t,n=i.length;n--;)i[n].file==e&&(t=i.splice(n,1),o-=t.size);return t},n},_getFilesDataArray:function(e){var t=[],n={};if(d(e)){var i=ne.getFiles(e);n[e.name||"file"]=null!==e.getAttribute("multiple")?i:i[0]}else Q(e)&&d(e[0])?V(e,function(e){n[e.name||"file"]=ne.getFiles(e)}):n=e;return V(n,function e(n,i){Q(n)?V(n,function(t){e(t,i)}):n&&(n.name||n.image)&&t.push({name:i,file:n,size:n.size,total:n.size,loaded:0})}),t.length||t.push({file:{name:ne.expando}}),t},_getFormData:function(e,t,n){var i=t.file,a=t.name,o=i.name,r=i.type,s=ne.support.transform&&e.imageTransform,l=new ne.Form,c=ne.queue(function(){n(l)}),d=s&&p(s),u=ne.postNameConcat;V(e.data,function e(t,n){"object"==typeof t?V(t,function(t,i){e(t,u(n,i))}):l.append(n,t)}),function t(n){n.image?(c.inc(),n.toData(function(e,i){n.file&&(i.type=n.file.type,i.quality=n.matrix.quality,o=n.file&&n.file.name),o=o||(new Date).getTime()+".png",t(i),c.next()})):ne.Image&&s&&(/^image/.test(n.type)||P.test(n.nodeName))?(c.inc(),d&&(s=[s]),ne.Image.transform(n,s,e.imageAutoOrientation,function(t,i){if(d&&!t)E||ne.flashEngine||(l.multipart=!0),l.append(a,i[0],o,s[0].type||r);else{var p=0;t||V(i,function(e,t){E||ne.flashEngine||(l.multipart=!0),s[t].postName||(p=1),l.append(s[t].postName||u(a,t),e,o,s[t].type||r)}),(t||e.imageOriginal)&&l.append(u(a,p?"original":null),n,o,r)}c.next()})):o!==ne.expando&&l.append(a,n,o)}(i),c.check()},reset:function(e,t){var n,i;return $?(i=$(e).clone(!0).insertBefore(e).val("")[0],t||$(e).remove()):(n=e.parentNode,i=n.insertBefore(e.cloneNode(!0),e),i.value="",t||n.removeChild(e),V(N[ne.uid(e)],function(t,n){V(t,function(t){Y(e,n,t),J(i,n,t)})})),i},load:function(e,t){var n=ne.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),J(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){e=e.split("/");var i={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};i.dataURL="data:"+i.type+";base64,"+ne.encode64(n.responseBody||n.responseText),t({type:"load",result:i},n)}else t({type:"error"},n)},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",i=0;for("string"!=typeof e&&(e=String(e));i<e.length;){var a,o,r=255&e.charCodeAt(i++),s=255&e.charCodeAt(i++),l=255&e.charCodeAt(i++),c=r>>2,d=(3&r)<<4|s>>4;isNaN(s)?a=o=64:(a=(15&s)<<2|l>>6,o=isNaN(l)?64:63&l),n+=t.charAt(c)+t.charAt(d)+t.charAt(a)+t.charAt(o)}return n}};ne.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=ne.defer();ne.readAsImage(e,function(e){var t=e.target;n.resolve("load"!=e.type&&"error",{width:t.width,height:t.height}),t.src=ne.EMPTY_PNG,t=null})}e.__dimensions.then(t)}),ne.event.dnd=function(e,t,n){var i,a;n||(n=t,t=ne.F),C?(J(e,"dragenter dragleave dragover",t.ff=t.ff||function(e){for(var n=u(e).types,o=n&&n.length,r=!1;o--;)if(~n[o].indexOf("File")){e[W](),a!==e.type&&(a=e.type,"dragleave"!=a&&t.call(e[X],!0,e),r=!0);break}r&&(clearTimeout(i),i=setTimeout(function(){t.call(e[X],"dragleave"!=a,e)},50))}),J(e,"drop",n.ff=n.ff||function(e){e[W](),a=0,t.call(e[X],!1,e),ne.getDropFiles(e,function(t,i){n.call(e[X],t,i,e)})})):ne.log("Drag'n'Drop -- not supported")},ne.event.dnd.off=function(e,t,n){Y(e,"dragenter dragleave dragover",t.ff),Y(e,"drop",n.ff)},$&&!$.fn.dnd&&($.fn.dnd=function(e,t){return this.each(function(){ne.event.dnd(this,e,t)})},$.fn.offdnd=function(e,t){return this.each(function(){ne.event.dnd.off(this,e,t)})}),e.FileAPI=K(ne,e.FileAPI),ne.log("FileAPI: "+ne.version),ne.log("protocol: "+e.location.protocol),ne.log("doctype: ["+y.name+"] "+y.publicId+" "+y.systemId),V(v.getElementsByTagName("meta"),function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&ne.log("meta.http-equiv: "+e.getAttribute("content"))});try{f=!!console.log,h=!!console.log.apply}catch(e){}ne.flashUrl||(ne.flashUrl=ne.staticPath+"FileAPI.flash.swf"),ne.flashImageUrl||(ne.flashImageUrl=ne.staticPath+"FileAPI.flash.image.swf"),ne.flashWebcamUrl||(ne.flashWebcamUrl=ne.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(e,t,n){"use strict";function i(t){if(t instanceof i){var n=new i(t.file);return e.extend(n.matrix,t.matrix),n}if(!(this instanceof i))return new i(t);this.file=t,this.size=t.size||100,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0}}var a=Math.min,o=Math.round,r=function(){return t.createElement("canvas")},s=!1,l={8:270,3:180,6:90,7:270,4:180,5:90};try{s=r().toDataURL("image/png").indexOf("data:image/png")>-1}catch(e){}i.prototype={image:!0,constructor:i,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,i,a){return i===n&&(i=e,a=t,e=t=0),this.set({sx:e,sy:t,sw:i,sh:a||i})},resize:function(e,t,n){return/min|max|height|width/.test(t)&&(n=t,t=e),this.set({dw:e,dh:t||e,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new i(this)},_load:function(t,n){var i=this;/img|video/i.test(t.nodeName)?n.call(i,null,t):e.readAsImage(t,function(e){n.call(i,"load"!=e.type,e.result)})},_apply:function(t,n){var o,s=r(),l=this.getMatrix(t),c=s.getContext("2d"),d=t.videoWidth||t.width,u=t.videoHeight||t.height,p=l.deg,f=l.dw,h=l.dh,m=d,g=u,v=l.filter,y=t,b=l.overlay,w=e.queue(function(){t.src=e.EMPTY_PNG,n(!1,s)}),x=e.renderImageToCanvas;for(p-=360*Math.floor(p/360),t._type=this.file.type;l.multipass&&a(m/f,g/h)>2;)m=m/2+.5|0,g=g/2+.5|0,o=r(),o.width=m,o.height=g,y!==t?(x(o,y,0,0,y.width,y.height,0,0,m,g),y=o):(y=o,x(y,t,l.sx,l.sy,l.sw,l.sh,0,0,m,g),l.sx=l.sy=l.sw=l.sh=0);s.width=p%180?h:f,s.height=p%180?f:h,s.type=l.type,s.quality=l.quality,c.rotate(p*Math.PI/180),x(c.canvas,y,l.sx,l.sy,l.sw||y.width,l.sh||y.height,180==p||270==p?-f:0,90==p||180==p?-h:0,f,h),f=s.width,h=s.height,b&&e.each([].concat(b),function(t){w.inc();var n=new window.Image,i=function(){var a=0|t.x,o=0|t.y,r=t.w||n.width,s=t.h||n.height,l=t.rel;a=1==l||4==l||7==l?(f-r+a)/2:2==l||5==l||8==l?f-(r+a):a,o=3==l||4==l||5==l?(h-s+o)/2:l>=6?h-(s+o):o,e.event.off(n,"error load abort",i);try{c.globalAlpha=t.opacity||1,c.drawImage(n,a,o,r,s)}catch(e){}w.next()};e.event.on(n,"error load abort",i),n.src=t.src,n.complete&&i()}),v&&(w.inc(),i.applyFilter(s,v,w.next)),w.check()},getMatrix:function(t){var n=e.extend({},this.matrix),i=n.sw=n.sw||t.videoWidth||t.naturalWidth||t.width,r=n.sh=n.sh||t.videoHeight||t.naturalHeight||t.height,s=n.dw=n.dw||i,l=n.dh=n.dh||r,c=i/r,d=s/l,u=n.resize;if("preview"==u){if(s!=i||l!=r){var p,f;d>=c?(p=i,f=p/d):(f=r,p=f*d),p==i&&f==r||(n.sx=~~((i-p)/2),n.sy=~~((r-f)/2),i=p,r=f)}}else"height"==u?s=l*c:"width"==u?l=s/c:u&&(i>s||r>l?"min"==u?(s=o(c<d?a(i,s):l*c),l=o(c<d?s/c:a(r,l))):(s=o(c>=d?a(i,s):l*c),l=o(c>=d?s/c:a(r,l))):(s=i,l=r));return n.sw=i,n.sh=r,n.dw=s,n.dh=l,n.multipass=e.multiPassResize,n},_trans:function(t){this._load(this.file,function(n,i){if(n)t(n);else try{this._apply(i,t)}catch(n){e.log("[err] FileAPI.Image.fn._apply:",n),t(n)}})},get:function(t){if(e.support.transform){var n=this,i=n.matrix;"auto"==i.deg?e.getInfo(n.file,function(e,a){i.deg=l[a&&a.exif&&a.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support_transform");return this},toData:function(e){return this.get(e)}},i.exifOrientation=l,i.transform=function(t,a,o,r){function s(s,l){var c={},d=e.queue(function(e){r(e,c)});s?d.fail():e.each(a,function(e,a){if(!d.isFail()){var r=new i(l.nodeType?l:t),s="function"==typeof e;if(s?e(l,r):e.width?r[e.preview?"preview":"resize"](e.width,e.height,e.strategy):e.maxWidth&&(l.width>e.maxWidth||l.height>e.maxHeight)&&r.resize(e.maxWidth,e.maxHeight,"max"),e.crop){var u=e.crop;r.crop(0|u.x,0|u.y,u.w||u.width,u.h||u.height)}e.rotate===n&&o&&(e.rotate="auto"),r.set({type:r.matrix.type||e.type||t.type||"image/png"}),s||r.set({deg:e.rotate,overlay:e.overlay,filter:e.filter,quality:e.quality||1}),d.inc(),r.toData(function(e,t){e?d.fail():(c[a]=t,d.next())})}})}t.width?s(!1,t):e.getInfo(t,s)},e.each(["TOP","CENTER","BOTTOM"],function(t,n){e.each(["LEFT","CENTER","RIGHT"],function(e,a){i[t+"_"+e]=3*n+a,i[e+"_"+t]=3*n+a})}),i.toCanvas=function(e){var n=t.createElement("canvas");return n.width=e.videoWidth||e.width,n.height=e.videoHeight||e.height,n.getContext("2d").drawImage(e,0,0),n},i.fromDataURL=function(t,n,i){var a=e.newImage(t);e.extend(a,n),i(a)},i.applyFilter=function(t,n,a){"function"==typeof n?n(t,a):window.Caman&&window.Caman("IMG"==t.tagName?i.toCanvas(t):t,function(){"string"==typeof n?this[n]():e.each(n,function(e,t){this[t](e)},this),this.render(a)})},e.renderImageToCanvas=function(t,n,i,a,o,r,s,l,c,d){try{return t.getContext("2d").drawImage(n,i,a,o,r,s,l,c,d)}catch(t){throw e.log("renderImageToCanvas failed"),t}},e.support.canvas=e.support.transform=s,e.Image=i}(FileAPI,document),function(e){"use strict";e(FileAPI)}(function(e){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var t=e.renderImageToCanvas;e.detectSubsampling=function(e){var t,n;return e.width*e.height>1048576&&(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,1-e.width,0),0===n.getImageData(0,0,1,1).data[3])},e.detectVerticalSquash=function(e,t){var n,i,a,o,r,s=e.naturalHeight||e.height,l=document.createElement("canvas"),c=l.getContext("2d");for(t&&(s/=2),l.width=1,l.height=s,c.drawImage(e,0,0),n=c.getImageData(0,0,1,s).data,i=0,a=s,o=s;o>i;)r=n[4*(o-1)+3],0===r?a=o:i=o,o=a+i>>1;return o/s||1},e.renderImageToCanvas=function(n,i,a,o,r,s,l,c,d,u){if("image/jpeg"===i._type){var p,f,h,m,g=n.getContext("2d"),v=document.createElement("canvas"),y=1024,b=v.getContext("2d");if(v.width=y,v.height=y,g.save(),p=e.detectSubsampling(i),p&&(a/=2,o/=2,r/=2,s/=2),f=e.detectVerticalSquash(i,p),p||1!==f){for(o*=f,d=Math.ceil(y*d/r),u=Math.ceil(y*u/s/f),c=0,m=0;m<s;){for(l=0,h=0;h<r;)b.clearRect(0,0,y,y),b.drawImage(i,a,o,r,s,-h,-m,r,s),g.drawImage(v,0,0,y,y,l,c,d,u),h+=y,l+=d;m+=y,c+=u}return g.restore(),n}}return t(n,i,a,o,r,s,l,c,d,u)}}}),function(e,t){"use strict";function n(t,n,i){var a=t.blob,o=t.file;if(o){if(!a.toDataURL)return void e.readAsBinaryString(a,function(e){"load"==e.type&&n(t,e.result)});var r={"image/jpeg":".jpe?g","image/png":".png"},s=r[t.type]?t.type:"image/png",l=r[s]||".png",c=a.quality||1;o.match(new RegExp(l+"$","i"))||(o+=l.replace("?","")),t.file=o,t.type=s,!i&&a.toBlob?a.toBlob(function(e){n(t,e)},s,c):n(t,e.toBinaryString(a.toDataURL(s,c)))}else n(t,a)}var i=t.document,a=t.FormData,o=function(){this.items=[]},r=t.encodeURIComponent;o.prototype={append:function(e,t,n,i){this.items.push({name:e,blob:t&&t.blob||(void 0==t?"":t),file:t&&(n||t.name),type:t&&(i||t.type)})},each:function(e){for(var t=0,n=this.items.length;t<n;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,function(e){return e.file}).length,e.support.html5?e.formData&&!this.multipart&&a?n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,i,a){var o=e.queue(function(){n(t)});this.each(function(r){try{i(r,t,o,a)}catch(t){e.log("FileAPI.Form._to: "+t.message),n(t)}}),o.check()},toHtmlData:function(t){this._to(i.createDocumentFragment(),t,function(t,n){var a,o=t.blob;t.file?(e.reset(o,!0),o.name=t.name,o.disabled=!1,n.appendChild(o)):(a=i.createElement("input"),a.name=t.name,a.type="hidden",a.value=o,n.appendChild(a))})},toPlainData:function(e){this._to({},e,function(e,t,i){e.file&&(t.type=e.file),e.blob.toBlob?(i.inc(),n(e,function(e,n){t.name=e.name,t.file=n,t.size=n.length,t.type=e.type,i.next()})):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(r(e.name)+"="+r(e.blob))),t.start=-1,t.end=t.file&&t.file.FileAPIReadPosition||-1,t.retry=0})},toFormData:function(e){this._to(new a,e,function(e,t,i){e.blob&&e.blob.toBlob?(i.inc(),n(e,function(e,n){t.append(e.name,n,e.file),i.next()})):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob),e.file&&t.append("_"+e.name,e.file)})},toMultipartData:function(t){this._to([],t,function(e,t,i,a){i.inc(),n(e,function(e,n){t.push("--_"+a+'\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+r(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n\r\n"+(e.file?n:r(n))+"\r\n"),i.next()},!0)},e.expando)}},e.Form=o}(FileAPI,window),function(e,t){"use strict";var n=function(){},i=e.document,a=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},o={"":1,XML:1,Text:1,Body:1};a.prototype={status:0,statusText:"",constructor:a,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(i,a){var o=this,r=o.options;o.end=o.abort=n,o.status=i,a&&(o.statusText=a),t.log("xhr.end:",i,a),r.complete(200!=i&&201!=i&&(o.statusText||"unknown"),o),o.xhr&&o.xhr.node&&setTimeout(function(){var t=o.xhr.node;try{t.parentNode.removeChild(t)}catch(e){}try{delete e[o.uid]}catch(e){}e[o.uid]=o.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){e instanceof Error?t.end(0,e.message):(n.upload(n,t),t._send.call(t,n,e))},n)},_send:function(n,a){var r,s=this,l=s.uid,c=s.uid+"Load",d=n.url;if(t.log("XHR._send:",a),n.cache||(d+=(~d.indexOf("?")?"&":"?")+t.uid()),a.nodeName){var u=n.jsonp;d=d.replace(/([a-z]+)=(\?)/i,"$1="+l),n.upload(n,s);var p=function(e){if(~d.indexOf(e.origin))try{var n=t.parseJSON(e.data);n.id==l&&f(n.status,n.statusText,n.response)}catch(e){f(0,e.message)}},f=e[l]=function(n,i,a){s.readyState=4,s.responseText=a,s.end(n,i),t.event.off(e,"message",p),e[l]=r=m=e[c]=null};s.xhr.abort=function(){try{m.stop?m.stop():m.contentWindow.stop?m.contentWindow.stop():m.contentWindow.document.execCommand("Stop")}catch(e){}f(0,"abort")},t.event.on(e,"message",p),e[c]=function(){try{var e=m.contentWindow,n=e.document,i=e.result||t.parseJSON(n.body.innerHTML);f(i.status,i.statusText,i.response)}catch(e){t.log("[transport.onload]",e)}},r=i.createElement("div"),r.innerHTML='<form target="'+l+'" action="'+d+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+l+'" src="javascript:false;" onload="window.'+c+" && "+c+'();"></iframe>'+(u&&n.url.indexOf("=?")<0?'<input value="'+l+'" name="'+u+'" type="hidden"/>':"")+"</form>";var h=r.getElementsByTagName("form")[0],m=r.getElementsByTagName("iframe")[0];h.appendChild(a),t.log(h.parentNode.innerHTML),i.body.appendChild(r),s.xhr.node=r,s.readyState=2;try{h.submit()}catch(e){t.log("iframe.error: "+e)}h=null}else{if(d=d.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted)return void t.log("Error: already aborted");if(r=s.xhr=t.getXHR(),a.params&&(d+=(d.indexOf("?")<0?"?":"&")+a.params.join("&")),r.open("POST",d,!0),t.withCredentials&&(r.withCredentials="true"),n.headers&&n.headers["X-Requested-With"]||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){r.setRequestHeader(t,e)}),n._chunked){r.upload&&r.upload.addEventListener("progress",t.throttle(function(e){a.retry||n.progress({type:e.type,total:a.size,loaded:a.start+e.loaded,totalSize:a.size},s,n)},100),!1),r.onreadystatechange=function(){var e=parseInt(r.getResponseHeader("X-Last-Known-Byte"),10);if(s.status=r.status,s.statusText=r.statusText,s.readyState=r.readyState,4==r.readyState){for(var i in o)s["response"+i]=r["response"+i];if(r.onreadystatechange=null,!r.status||r.status-201>0)if(t.log("Error: "+r.status),(!r.status&&!r.aborted||500==r.status||416==r.status)&&++a.retry<=n.chunkUploadRetry){var l=r.status?0:t.chunkNetworkDownRetryTimeout;n.pause(a.file,n),t.log("X-Last-Known-Byte: "+e),e?a.end=e:(a.end=a.start-1,416==r.status&&(a.end=a.end-n.chunkSize)),setTimeout(function(){s._send(n,a)},l)}else s.end(r.status);else a.retry=0,a.end==a.size-1?s.end(r.status):(t.log("X-Last-Known-Byte: "+e),e&&(a.end=e),a.file.FileAPIReadPosition=a.end,setTimeout(function(){s._send(n,a)},0));r=null}},a.start=a.end+1,a.end=Math.max(Math.min(a.start+n.chunkSize,a.size)-1,a.start);var g=a.file,v=(g.slice||g.mozSlice||g.webkitSlice).call(g,a.start,a.end+1);a.size&&!v.size?setTimeout(function(){s.end(-1)}):(r.setRequestHeader("Content-Range","bytes "+a.start+"-"+a.end+"/"+a.size),r.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(a.name)),r.setRequestHeader("Content-Type",a.type||"application/octet-stream"),r.send(v)),g=v=null}else if(r.upload&&r.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,s,n)},100),!1),r.onreadystatechange=function(){if(s.status=r.status,s.statusText=r.statusText,s.readyState=r.readyState,4==r.readyState){for(var e in o)s["response"+e]=r["response"+e];if(r.onreadystatechange=null,!r.status||r.status>201)if(t.log("Error: "+r.status),(!r.status&&!r.aborted||500==r.status)&&(n.retry||0)<n.uploadRetry){n.retry=(n.retry||0)+1;var i=t.networkDownRetryTimeout;n.pause(n.file,n),setTimeout(function(){s._send(n,a)},i)}else s.end(r.status);else s.end(r.status);r=null}},t.isArray(a)){r.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando);var y=a.join("")+"--_"+t.expando+"--";if(r.sendAsBinary)r.sendAsBinary(y);else{var b=Array.prototype.map.call(y,function(e){return 255&e.charCodeAt(0)});r.send(new Uint8Array(b).buffer)}}else r.send(a)}}},t.XHR=a}(window,FileAPI),function(e,t){"use strict";function n(e){return e>=0?e+"px":e}function i(e){var n,i=o.createElement("canvas"),a=!1;try{n=i.getContext("2d"),n.drawImage(e,0,0,1,1),a=255!=n.getImageData(0,0,1,1).data[4]}catch(e){t.log("[FileAPI.Camera] detectVideoSignal:",e)}return a}var a=e.URL||e.webkitURL,o=e.document,r=e.navigator,s=r.getUserMedia||r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia,l=!!s;t.support.media=l;var c=function(e){this.video=e};c.prototype={isActive:function(){return!!this._active},start:function(e){var t,n,o=this,l=o.video,c=function(i){o._active=!i,clearTimeout(n),clearTimeout(t),e&&e(i,o)};s.call(r,{video:!0},function(e){o.stream=e,l.src=a.createObjectURL(e),t=setInterval(function(){i(l)&&c(null)},1e3),n=setTimeout(function(){c("timeout")},5e3),l.play()},c)},stop:function(){try{this._active=!1,this.video.pause();try{this.stream.stop()}catch(e){t.each(this.stream.getTracks(),function(e){e.stop()})}this.stream=null}catch(e){t.log("[FileAPI.Camera] stop:",e)}},shot:function(){return new d(this.video)}},c.get=function(e){return new c(e.firstChild)},c.publish=function(i,a,r){"function"==typeof a&&(r=a,a={}),a=t.extend({},{width:"100%",height:"100%",start:!0},a),i.jquery&&(i=i[0]);var s=function(e){if(e)r(e);else{var t=c.get(i);a.start?t.start(r):r(null,t)}};if(i.style.width=n(a.width),i.style.height=n(a.height),t.html5&&l){var d=o.createElement("video");d.style.width=n(a.width),d.style.height=n(a.height),e.jQuery?jQuery(i).empty():i.innerHTML="",i.appendChild(d),s()}else c.fallback(i,a,s)},c.fallback=function(e,t,n){n("not_support_camera")};var d=function(e){var n=e.nodeName?t.Image.toCanvas(e):e,i=t.Image(n);return i.type="image/png",i.width=n.width,i.height=n.height,i.size=n.width*n.height*4,i};c.Shot=d,t.Camera=c}(window,FileAPI),function(e,t,n){"use strict";var i=n.each,a=[];!n.support.flash||!n.media||n.support.media&&n.html5||function(){function e(e){var t=e.wid=n.uid();return n.Flash._fn[t]=e,"FileAPI.Flash._fn."+t}function t(e){try{n.Flash._fn[e.wid]=null,delete n.Flash._fn[e.wid]}catch(e){}}var o=n.Flash;n.extend(n.Flash,{patchCamera:function(){n.Camera.fallback=function(i,a,r){var s=n.uid();n.log("FlashAPI.Camera.publish: "+s),o.publish(i,s,n.extend(a,{camera:!0,onEvent:e(function e(i){"camera"===i.type&&(t(e),i.error?(n.log("FlashAPI.Camera.publish.error: "+i.error),r(i.error)):(n.log("FlashAPI.Camera.publish.success: "+s),r(null)))})}))},i(a,function(e){n.Camera.fallback.apply(n.Camera,e)}),a=[],n.extend(n.Camera.prototype,{_id:function(){return this.video.id},start:function(i){var a=this;o.cmd(this._id(),"camera.on",{callback:e(function e(o){t(e),o.error?(n.log("FlashAPI.camera.on.error: "+o.error),i(o.error,a)):(n.log("FlashAPI.camera.on.success: "+a._id()),a._active=!0,i(null,a))})})},stop:function(){this._active=!1,o.cmd(this._id(),"camera.off")},shot:function(){n.log("FlashAPI.Camera.shot:",this._id());var e=n.Flash.cmd(this._id(),"shot",{});return e.type="image/png",e.flashId=this._id(),e.isShot=!0,new n.Camera.Shot(e)}})}}),n.Camera.fallback=function(){a.push(arguments)}}()}(window,window.jQuery,FileAPI),"function"==typeof define&&define.amd&&define("FileAPI",[],function(){return FileAPI}),function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=(n||a)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,r,s,l,c;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),o=new ArrayBuffer(t.length),r=new Uint8Array(o),s=0;s<t.length;s+=1)r[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([i?r:o],{type:l}):(c=new a,c.append(o),c.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,i){e(i&&t.toDataURL&&o?o(this.toDataURL(n,i)):this.mozGetAsFile("blob",n))}:t.toDataURL&&o&&(t.toBlob=function(e,t,n){
e(o(this.toDataURL(t,n)))})),e.dataURLtoBlob=o}(window),function(e,t){"use strict";function n(e,t,n,i,a){var o={type:n.type||n,target:e,result:i};K(o,a),t(o)}function i(e){return C&&!!C.prototype["readAs"+e]}function a(e,a,o,r){if(ne.isBlob(e)&&i(o)){var s=new C;J(s,G,function t(i){var o=i.type;"progress"==o?n(e,a,i,i.target.result,{loaded:i.loaded,total:i.total}):"loadend"==o?(Y(s,G,t),s=null):n(e,a,i,i.target.result)});try{r?s["readAs"+o](e,r):s["readAs"+o](e)}catch(i){n(e,a,"error",t,{error:i.toString()})}}else n(e,a,"error",t,{error:"filreader_not_support_"+o})}function o(e,t){if(!e.type&&(w||e.size%4096==0&&e.size<=102400))if(C)try{var n=new C;Z(n,G,function(e){var i="error"!=e.type;i?(null!=n.readyState&&n.readyState!==n.LOADING||n.abort(),t(i)):t(!1,n.error)}),n.readAsDataURL(e)}catch(e){t(!1,e)}else t(null,new Error("FileReader is not supported"));else t(!0)}function r(e){return e&&(e.isFile||e.isDirectory)}function s(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function l(e,t){if(e)if(e.isFile)e.file(function(n){n.fullPath=e.fullPath,t(!1,[n],[n])},function(n){e.error=n,t("FileError.code: "+n.code,[],[e])});else if(e.isDirectory){var n=e.createReader(),i=!0,a=[],o=[e],r=function(n){e.error=n,t("DirectoryError.code: "+n.code,a,o)},c=function s(c){i&&(i=!1,c.length||(e.error=new Error("directory is empty"))),c.length?ne.afor(c,function(e,t){l(t,function(t,i,l){t||(a=a.concat(i)),o=o.concat(l),e?e():n.readEntries(s,r)})}):t(!1,a,o)};n.readEntries(c,r)}else l(s(e),t);else{var d=new Error("invalid entry");e=new Object(e),e.error=d,t(d.message,[],[e])}}function c(e){var t={};return V(e,function(e,n){e&&"object"==typeof e&&void 0===e.nodeType&&(e=K({},e)),t[n]=e}),t}function d(e){return z.test(e&&e.tagName)}function u(e){return(e.originalEvent||e||"").dataTransfer||{}}function p(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||"overlay"===t||"filter"===t))return!0;return!1}var f,h,m=1,g=function(){},v=e.document,y=v.doctype||{},b=e.navigator.userAgent,w=/safari\//i.test(b)&&!/chrome\//i.test(b),x=/iemobile\//i.test(b),A=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,_=e.Blob,j=e.File,C=e.FileReader,F=e.FormData,k=e.XMLHttpRequest,$=e.jQuery,T=!(!(j&&C&&(e.Uint8Array||F||k.prototype.sendAsBinary))||w&&/windows/i.test(b)&&!x),I=T&&"withCredentials"in new k,L=T&&!!_&&!!(_.prototype.webkitSlice||_.prototype.mozSlice||_.prototype.slice),R=(""+"".normalize).indexOf("[native code]")>0,E=e.dataURLtoBlob,S=/img/i,D=/canvas/i,P=/img|canvas/i,z=/input/i,B=/^data:[^,]+,/,U={}.toString,M=e.Math,H=function(t){return t=new e.Number(M.pow(1024,t)),t.from=function(e){return M.round(e*this)},t},N={},O=[],G="abort progress error load loadend",q="status statusText readyState response responseXML responseText responseBody".split(" "),X="currentTarget",W="preventDefault",Q=function(e){return e&&"length"in e},V=function(e,t,n){if(e)if(Q(e))for(var i=0,a=e.length;i<a;i++)i in e&&t.call(n,e[i],i,e);else for(var o in e)e.hasOwnProperty(o)&&t.call(n,e[o],o,e)},K=function(e){for(var t=arguments,n=1,i=function(t,n){e[n]=t};n<t.length;n++)V(t[n],i);return e},J=function(e,t,n){if(e){var i=ne.uid(e);N[i]||(N[i]={});var a=C&&e&&e instanceof C;V(t.split(/\s+/),function(t){$&&!a?$.event.add(e,t,n):(N[i][t]||(N[i][t]=[]),N[i][t].push(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)})}},Y=function(e,t,n){if(e){var i=ne.uid(e),a=N[i]||{},o=C&&e&&e instanceof C;V(t.split(/\s+/),function(t){if($&&!o)$.event.remove(e,t,n);else{for(var i=a[t]||[],r=i.length;r--;)if(i[r]===n){i.splice(r,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}})}},Z=function(e,t,n){J(e,t,function i(a){Y(e,t,i),n(a)})},ee=function(t){return t.target||(t.target=e.event&&e.event.srcElement||v),3===t.target.nodeType&&(t.target=t.target.parentNode),t},te=function(e){var t=v.createElement("input");return t.setAttribute("type","file"),e in t},ne={version:"2.0.19",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(null!=t?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:H(1),MB:H(2),GB:H(3),TB:H(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[ne.expando]=e[ne.expando]||ne.uid():(++m,ne.expando+m)},log:function(){ne.debug&&f&&(h?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,t){var n=v.createElement("img");return t&&ne.event.one(n,"error load",function(e){t("error"==e.type,n),n=null}),n.src=e,n},getXHR:function(){var t;if(k)t=new k;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:Q,support:{dnd:I&&"ondrop"in v.createElement("div"),cors:I,html5:T,chunked:L,dataURI:!0,accept:te("accept"),multiple:te("multiple")},event:{on:J,off:Y,one:Z,fix:ee},throttle:function(t,n){var i,a;return function(){a=arguments,i||(t.apply(e,a),i=setTimeout(function(){i=0,t.apply(e,a)},n))}},F:function(){},parseJSON:function(t){return e.JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return e=String(e),e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e,n,i=[],a={resolve:function(t,o){for(a.resolve=g,n=t||!1,e=o;o=i.shift();)o(n,e)},then:function(a){n!==t?a(n,e):i.push(a)}};return a},queue:function(e){var t=0,n=0,i=!1,a=!1,o={inc:function(){n++},next:function(){t++,setTimeout(o.check,0)},check:function(){t>=n&&!i&&o.end()},isFail:function(){return i},fail:function(){!i&&e(i=!0)},end:function(){a||(a=!0,e())}};return o},each:V,afor:function(e,t){var n=0,i=e.length;Q(e)&&i--?function a(){t(i!=n&&a,e[n],n++)}():t(!1)},extend:K,isFile:function(e){return"[object File]"===U.call(e)},isBlob:function(e){return this.isFile(e)||"[object Blob]"===U.call(e)},isCanvas:function(e){return e&&D.test(e.nodeName)},getFilesFilter:function(e){return e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"",e?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){ne.isCanvas(e)?n(e,t,"load",ne.toDataURL(e)):a(e,t,"DataURL")},readAsBinaryString:function(e,t){i("BinaryString")?a(e,t,"BinaryString"):a(e,function(e){if("load"==e.type)try{e.result=ne.toBinaryString(e.result)}catch(t){e.type="error",e.message=t.toString()}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){a(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),a(e,n,"Text",t)},toDataURL:function(e,t){return"string"==typeof e?e:e.toDataURL?e.toDataURL(t||"image/png"):void 0},toBinaryString:function(t){return e.atob(ne.toDataURL(t).replace(B,""))},readAsImage:function(e,i,a){if(ne.isBlob(e))if(A){var o=A.createObjectURL(e);o===t?n(e,i,"error"):ne.readAsImage(o,i,a)}else ne.readAsDataURL(e,function(t){"load"==t.type?ne.readAsImage(t.result,i,a):(a||"error"==t.type)&&n(e,i,t,null,{loaded:t.loaded,total:t.total})});else if(ne.isCanvas(e))n(e,i,"load",e);else if(S.test(e.nodeName))if(e.complete)n(e,i,"load",e);else{var r="error abort load";Z(e,r,function t(a){"load"==a.type&&A&&A.revokeObjectURL(e.src),Y(e,r,t),n(e,i,a,e)})}else if(e.iframe)n(e,i,{type:"error"});else{var s=ne.newImage(e.dataURL||e);ne.readAsImage(s,i,a)}},checkFileObj:function(e){var t={},n=ne.accept;return"object"==typeof e?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),V(n,function(e,n){e=new RegExp(e.replace(/\s/g,"|"),"i"),(e.test(t.type)||ne.ext2mime[t.type])&&(t.type=ne.ext2mime[t.type]||n.split("/")[0]+"/"+t.type)}),t},getDropFiles:function(e,t){var n,i=[],a=[],c=u(e),d=c.files,p=c.items,f=Q(p)&&p[0]&&s(p[0]),h=ne.queue(function(){t(i,a)});if(f)if(R&&d){var m,g,v=d.length;for(n=new Array(v);v--;){m=d[v];try{g=s(p[v])}catch(e){ne.log("[err] getDropFiles: ",e),g=null}r(g)&&(g.isDirectory||g.isFile&&m.name==m.name.normalize("NFC"))?n[v]=g:n[v]=m}}else n=p;else n=d;V(n||[],function(e){h.inc();try{f&&r(e)?l(e,function(e,t,n){e?ne.log("[err] getDropFiles:",e):i.push.apply(i,t),a.push.apply(a,n),h.next()}):o(e,function(t,n){t?i.push(e):e.error=n,a.push(e),h.next()})}catch(e){h.next(),ne.log("[err] getDropFiles: ",e)}}),h.check()},getFiles:function(e,t,n){var i=[];return n?(ne.filterFiles(ne.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){i=i.concat(ne.getFiles(this))}),e=i,i=[]),"string"==typeof t&&(t=ne.getFilesFilter(t)),e.originalEvent?e=ee(e.originalEvent):e.srcElement&&(e=ee(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(i=e.files,T||(i[0].blob=e,i[0].iframe=!0)):!T&&d(e)?ne.trim(e.value)&&(i=[ne.checkFileObj(e.value)],i[0].blob=e,i[0].iframe=!0):Q(e)&&(i=e),ne.filter(i,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(e,t){var n={},i=O.concat();ne.isBlob(e)?function a(){var o=i.shift();o?o.test(e.type)?o(e,function(e,i){e?t(e):(K(n,i),a())}):a():t(!1,n)}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},O.push(t)},filter:function(e,t){for(var n,i=[],a=0,o=e.length;a<o;a++)a in e&&(n=e[a],t.call(n,n,a,e)&&i.push(n));return i},filterFiles:function(e,t,n){if(e.length){var i,a=e.concat(),o=[],r=[];!function e(){a.length?(i=a.shift(),ne.getInfo(i,function(n,a){(t(i,!n&&a)?o:r).push(i),e()})):n(o,r)}()}else n([],e)},upload:function(e){e=K({jsonp:"callback",prepare:ne.F,beforeupload:ne.F,upload:ne.F,fileupload:ne.F,fileprogress:ne.F,filecomplete:ne.F,progress:ne.F,complete:ne.F,pause:ne.F,imageOriginal:!0,chunkSize:ne.chunkSize,chunkUploadRetry:ne.chunkUploadRetry,uploadRetry:ne.uploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new ne.XHR(e),i=this._getFilesDataArray(e.files),a=this,o=0,r=0,s=!1;return V(i,function(e){o+=e.size}),n.files=[],V(i,function(e){n.files.push(e.file)}),n.total=o,n.loaded=0,n.filesLeft=i.length,e.beforeupload(n,e),t=function(){var l=i.shift(),d=l&&l.file,u=!1,p=c(e);if(n.filesLeft=i.length,d&&d.name===ne.expando&&(d=null,ne.log("[warn] FileAPI.upload() \u2014 called without files")),("abort"!=n.statusText||n.current)&&l){if(s=!1,n.currentFile=d,d&&!1===e.prepare(d,p))return void t.call(a);p.file=d,a._getFormData(p,l,function(s){r||e.upload(n,e);var c=new ne.XHR(K({},p,{upload:d?function(){e.fileupload(d,c,p)}:g,progress:d?function(t){u||(u=t.loaded===t.total,e.fileprogress({type:"progress",total:l.total=t.total,loaded:l.loaded=t.loaded},d,c,p),e.progress({type:"progress",total:o,loaded:n.loaded=r+l.size*(t.loaded/t.total)||0},d,c,p))}:g,complete:function(i){V(q,function(e){n[e]=c[e]}),d&&(l.total=l.total||l.size,l.loaded=l.total,i||(this.progress(l),u=!0,r+=l.size,n.loaded=r),e.filecomplete(i,c,d,p)),setTimeout(function(){t.call(a)},0)}}));n.abort=function(e){e||(i.length=0),this.current=e,c.abort()},c.send(s)})}else{var f=200==n.status||201==n.status||204==n.status;e.complete(!f&&(n.statusText||"error"),n,e),s=!0}},setTimeout(t,0),n.append=function(e,r){e=ne._getFilesDataArray([].concat(e)),V(e,function(e){o+=e.size,n.files.push(e.file),r?i.unshift(e):i.push(e)}),n.statusText="",s&&t.call(a)},n.remove=function(e){for(var t,n=i.length;n--;)i[n].file==e&&(t=i.splice(n,1),o-=t.size);return t},n},_getFilesDataArray:function(e){var t=[],n={};if(d(e)){var i=ne.getFiles(e);n[e.name||"file"]=null!==e.getAttribute("multiple")?i:i[0]}else Q(e)&&d(e[0])?V(e,function(e){n[e.name||"file"]=ne.getFiles(e)}):n=e;return V(n,function e(n,i){Q(n)?V(n,function(t){e(t,i)}):n&&(n.name||n.image)&&t.push({name:i,file:n,size:n.size,total:n.size,loaded:0})}),t.length||t.push({file:{name:ne.expando}}),t},_getFormData:function(e,t,n){var i=t.file,a=t.name,o=i.name,r=i.type,s=ne.support.transform&&e.imageTransform,l=new ne.Form,c=ne.queue(function(){n(l)}),d=s&&p(s),u=ne.postNameConcat;V(e.data,function e(t,n){"object"==typeof t?V(t,function(t,i){e(t,u(n,i))}):l.append(n,t)}),function t(n){n.image?(c.inc(),n.toData(function(e,i){n.file&&(i.type=n.file.type,i.quality=n.matrix.quality,o=n.file&&n.file.name),o=o||(new Date).getTime()+".png",t(i),c.next()})):ne.Image&&s&&(/^image/.test(n.type)||P.test(n.nodeName))?(c.inc(),d&&(s=[s]),ne.Image.transform(n,s,e.imageAutoOrientation,function(t,i){if(d&&!t)E||ne.flashEngine||(l.multipart=!0),l.append(a,i[0],o,s[0].type||r);else{var p=0;t||V(i,function(e,t){E||ne.flashEngine||(l.multipart=!0),s[t].postName||(p=1),l.append(s[t].postName||u(a,t),e,o,s[t].type||r)}),(t||e.imageOriginal)&&l.append(u(a,p?"original":null),n,o,r)}c.next()})):o!==ne.expando&&l.append(a,n,o)}(i),c.check()},reset:function(e,t){var n,i;return $?(i=$(e).clone(!0).insertBefore(e).val("")[0],t||$(e).remove()):(n=e.parentNode,i=n.insertBefore(e.cloneNode(!0),e),i.value="",t||n.removeChild(e),V(N[ne.uid(e)],function(t,n){V(t,function(t){Y(e,n,t),J(i,n,t)})})),i},load:function(e,t){var n=ne.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),J(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){e=e.split("/");var i={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};i.dataURL="data:"+i.type+";base64,"+ne.encode64(n.responseBody||n.responseText),t({type:"load",result:i},n)}else t({type:"error"},n)},n.send(null)):t({type:"error"}),n},encode64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",i=0;for("string"!=typeof e&&(e=String(e));i<e.length;){var a,o,r=255&e.charCodeAt(i++),s=255&e.charCodeAt(i++),l=255&e.charCodeAt(i++),c=r>>2,d=(3&r)<<4|s>>4;isNaN(s)?a=o=64:(a=(15&s)<<2|l>>6,o=isNaN(l)?64:63&l),n+=t.charAt(c)+t.charAt(d)+t.charAt(a)+t.charAt(o)}return n}};ne.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=ne.defer();ne.readAsImage(e,function(e){var t=e.target;n.resolve("load"!=e.type&&"error",{width:t.width,height:t.height}),t.src=ne.EMPTY_PNG,t=null})}e.__dimensions.then(t)}),ne.event.dnd=function(e,t,n){var i,a;n||(n=t,t=ne.F),C?(J(e,"dragenter dragleave dragover",t.ff=t.ff||function(e){for(var n=u(e).types,o=n&&n.length,r=!1;o--;)if(~n[o].indexOf("File")){e[W](),a!==e.type&&(a=e.type,"dragleave"!=a&&t.call(e[X],!0,e),r=!0);break}r&&(clearTimeout(i),i=setTimeout(function(){t.call(e[X],"dragleave"!=a,e)},50))}),J(e,"drop",n.ff=n.ff||function(e){e[W](),a=0,t.call(e[X],!1,e),ne.getDropFiles(e,function(t,i){n.call(e[X],t,i,e)})})):ne.log("Drag'n'Drop -- not supported")},ne.event.dnd.off=function(e,t,n){Y(e,"dragenter dragleave dragover",t.ff),Y(e,"drop",n.ff)},$&&!$.fn.dnd&&($.fn.dnd=function(e,t){return this.each(function(){ne.event.dnd(this,e,t)})},$.fn.offdnd=function(e,t){return this.each(function(){ne.event.dnd.off(this,e,t)})}),e.FileAPI=K(ne,e.FileAPI),ne.log("FileAPI: "+ne.version),ne.log("protocol: "+e.location.protocol),ne.log("doctype: ["+y.name+"] "+y.publicId+" "+y.systemId),V(v.getElementsByTagName("meta"),function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&ne.log("meta.http-equiv: "+e.getAttribute("content"))});try{f=!!console.log,h=!!console.log.apply}catch(e){}ne.flashUrl||(ne.flashUrl=ne.staticPath+"FileAPI.flash.swf"),ne.flashImageUrl||(ne.flashImageUrl=ne.staticPath+"FileAPI.flash.image.swf"),ne.flashWebcamUrl||(ne.flashWebcamUrl=ne.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(e,t,n){"use strict";function i(t){if(t instanceof i){var n=new i(t.file);return e.extend(n.matrix,t.matrix),n}if(!(this instanceof i))return new i(t);this.file=t,this.size=t.size||100,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0}}var a=Math.min,o=Math.round,r=function(){return t.createElement("canvas")},s=!1,l={8:270,3:180,6:90,7:270,4:180,5:90};try{s=r().toDataURL("image/png").indexOf("data:image/png")>-1}catch(e){}i.prototype={image:!0,constructor:i,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,i,a){return i===n&&(i=e,a=t,e=t=0),this.set({sx:e,sy:t,sw:i,sh:a||i})},resize:function(e,t,n){return/min|max|height|width/.test(t)&&(n=t,t=e),this.set({dw:e,dh:t||e,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new i(this)},_load:function(t,n){var i=this;/img|video/i.test(t.nodeName)?n.call(i,null,t):e.readAsImage(t,function(e){n.call(i,"load"!=e.type,e.result)})},_apply:function(t,n){var o,s=r(),l=this.getMatrix(t),c=s.getContext("2d"),d=t.videoWidth||t.width,u=t.videoHeight||t.height,p=l.deg,f=l.dw,h=l.dh,m=d,g=u,v=l.filter,y=t,b=l.overlay,w=e.queue(function(){t.src=e.EMPTY_PNG,n(!1,s)}),x=e.renderImageToCanvas;for(p-=360*Math.floor(p/360),t._type=this.file.type;l.multipass&&a(m/f,g/h)>2;)m=m/2+.5|0,g=g/2+.5|0,o=r(),o.width=m,o.height=g,y!==t?(x(o,y,0,0,y.width,y.height,0,0,m,g),y=o):(y=o,x(y,t,l.sx,l.sy,l.sw,l.sh,0,0,m,g),l.sx=l.sy=l.sw=l.sh=0);s.width=p%180?h:f,s.height=p%180?f:h,s.type=l.type,s.quality=l.quality,c.rotate(p*Math.PI/180),x(c.canvas,y,l.sx,l.sy,l.sw||y.width,l.sh||y.height,180==p||270==p?-f:0,90==p||180==p?-h:0,f,h),f=s.width,h=s.height,b&&e.each([].concat(b),function(t){w.inc();var n=new window.Image,i=function(){var a=0|t.x,o=0|t.y,r=t.w||n.width,s=t.h||n.height,l=t.rel;a=1==l||4==l||7==l?(f-r+a)/2:2==l||5==l||8==l?f-(r+a):a,o=3==l||4==l||5==l?(h-s+o)/2:l>=6?h-(s+o):o,e.event.off(n,"error load abort",i);try{c.globalAlpha=t.opacity||1,c.drawImage(n,a,o,r,s)}catch(e){}w.next()};e.event.on(n,"error load abort",i),n.src=t.src,n.complete&&i()}),v&&(w.inc(),i.applyFilter(s,v,w.next)),w.check()},getMatrix:function(t){var n=e.extend({},this.matrix),i=n.sw=n.sw||t.videoWidth||t.naturalWidth||t.width,r=n.sh=n.sh||t.videoHeight||t.naturalHeight||t.height,s=n.dw=n.dw||i,l=n.dh=n.dh||r,c=i/r,d=s/l,u=n.resize;if("preview"==u){if(s!=i||l!=r){var p,f;d>=c?(p=i,f=p/d):(f=r,p=f*d),p==i&&f==r||(n.sx=~~((i-p)/2),n.sy=~~((r-f)/2),i=p,r=f)}}else"height"==u?s=l*c:"width"==u?l=s/c:u&&(i>s||r>l?"min"==u?(s=o(c<d?a(i,s):l*c),l=o(c<d?s/c:a(r,l))):(s=o(c>=d?a(i,s):l*c),l=o(c>=d?s/c:a(r,l))):(s=i,l=r));return n.sw=i,n.sh=r,n.dw=s,n.dh=l,n.multipass=e.multiPassResize,n},_trans:function(t){this._load(this.file,function(n,i){if(n)t(n);else try{this._apply(i,t)}catch(n){e.log("[err] FileAPI.Image.fn._apply:",n),t(n)}})},get:function(t){if(e.support.transform){var n=this,i=n.matrix;"auto"==i.deg?e.getInfo(n.file,function(e,a){i.deg=l[a&&a.exif&&a.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support_transform");return this},toData:function(e){return this.get(e)}},i.exifOrientation=l,i.transform=function(t,a,o,r){function s(s,l){var c={},d=e.queue(function(e){r(e,c)});s?d.fail():e.each(a,function(e,a){if(!d.isFail()){var r=new i(l.nodeType?l:t),s="function"==typeof e;if(s?e(l,r):e.width?r[e.preview?"preview":"resize"](e.width,e.height,e.strategy):e.maxWidth&&(l.width>e.maxWidth||l.height>e.maxHeight)&&r.resize(e.maxWidth,e.maxHeight,"max"),e.crop){var u=e.crop;r.crop(0|u.x,0|u.y,u.w||u.width,u.h||u.height)}e.rotate===n&&o&&(e.rotate="auto"),r.set({type:r.matrix.type||e.type||t.type||"image/png"}),s||r.set({deg:e.rotate,overlay:e.overlay,filter:e.filter,quality:e.quality||1}),d.inc(),r.toData(function(e,t){e?d.fail():(c[a]=t,d.next())})}})}t.width?s(!1,t):e.getInfo(t,s)},e.each(["TOP","CENTER","BOTTOM"],function(t,n){e.each(["LEFT","CENTER","RIGHT"],function(e,a){i[t+"_"+e]=3*n+a,i[e+"_"+t]=3*n+a})}),i.toCanvas=function(e){var n=t.createElement("canvas");return n.width=e.videoWidth||e.width,n.height=e.videoHeight||e.height,n.getContext("2d").drawImage(e,0,0),n},i.fromDataURL=function(t,n,i){var a=e.newImage(t);e.extend(a,n),i(a)},i.applyFilter=function(t,n,a){"function"==typeof n?n(t,a):window.Caman&&window.Caman("IMG"==t.tagName?i.toCanvas(t):t,function(){"string"==typeof n?this[n]():e.each(n,function(e,t){this[t](e)},this),this.render(a)})},e.renderImageToCanvas=function(t,n,i,a,o,r,s,l,c,d){try{return t.getContext("2d").drawImage(n,i,a,o,r,s,l,c,d)}catch(t){throw e.log("renderImageToCanvas failed"),t}},e.support.canvas=e.support.transform=s,e.Image=i}(FileAPI,document),function(e){"use strict";e(FileAPI)}(function(e){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var t=e.renderImageToCanvas;e.detectSubsampling=function(e){var t,n;return e.width*e.height>1048576&&(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,1-e.width,0),0===n.getImageData(0,0,1,1).data[3])},e.detectVerticalSquash=function(e,t){var n,i,a,o,r,s=e.naturalHeight||e.height,l=document.createElement("canvas"),c=l.getContext("2d");for(t&&(s/=2),l.width=1,l.height=s,c.drawImage(e,0,0),n=c.getImageData(0,0,1,s).data,i=0,a=s,o=s;o>i;)r=n[4*(o-1)+3],0===r?a=o:i=o,o=a+i>>1;return o/s||1},e.renderImageToCanvas=function(n,i,a,o,r,s,l,c,d,u){if("image/jpeg"===i._type){var p,f,h,m,g=n.getContext("2d"),v=document.createElement("canvas"),y=1024,b=v.getContext("2d");if(v.width=y,v.height=y,g.save(),p=e.detectSubsampling(i),p&&(a/=2,o/=2,r/=2,s/=2),f=e.detectVerticalSquash(i,p),p||1!==f){for(o*=f,d=Math.ceil(y*d/r),u=Math.ceil(y*u/s/f),c=0,m=0;m<s;){for(l=0,h=0;h<r;)b.clearRect(0,0,y,y),b.drawImage(i,a,o,r,s,-h,-m,r,s),g.drawImage(v,0,0,y,y,l,c,d,u),h+=y,l+=d;m+=y,c+=u}return g.restore(),n}}return t(n,i,a,o,r,s,l,c,d,u)}}}),function(e,t){"use strict";function n(t,n,i){var a=t.blob,o=t.file;if(o){if(!a.toDataURL)return void e.readAsBinaryString(a,function(e){"load"==e.type&&n(t,e.result)});var r={"image/jpeg":".jpe?g","image/png":".png"},s=r[t.type]?t.type:"image/png",l=r[s]||".png",c=a.quality||1;o.match(new RegExp(l+"$","i"))||(o+=l.replace("?","")),t.file=o,t.type=s,!i&&a.toBlob?a.toBlob(function(e){n(t,e)},s,c):n(t,e.toBinaryString(a.toDataURL(s,c)))}else n(t,a)}var i=t.document,a=t.FormData,o=function(){this.items=[]},r=t.encodeURIComponent;o.prototype={append:function(e,t,n,i){this.items.push({name:e,blob:t&&t.blob||(void 0==t?"":t),file:t&&(n||t.name),type:t&&(i||t.type)})},each:function(e){for(var t=0,n=this.items.length;t<n;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,function(e){return e.file}).length,e.support.html5?e.formData&&!this.multipart&&a?n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,i,a){var o=e.queue(function(){n(t)});this.each(function(r){try{i(r,t,o,a)}catch(t){e.log("FileAPI.Form._to: "+t.message),n(t)}}),o.check()},toHtmlData:function(t){this._to(i.createDocumentFragment(),t,function(t,n){var a,o=t.blob;t.file?(e.reset(o,!0),o.name=t.name,o.disabled=!1,n.appendChild(o)):(a=i.createElement("input"),a.name=t.name,a.type="hidden",a.value=o,n.appendChild(a))})},toPlainData:function(e){this._to({},e,function(e,t,i){e.file&&(t.type=e.file),e.blob.toBlob?(i.inc(),n(e,function(e,n){t.name=e.name,t.file=n,t.size=n.length,t.type=e.type,i.next()})):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(r(e.name)+"="+r(e.blob))),t.start=-1,t.end=t.file&&t.file.FileAPIReadPosition||-1,t.retry=0})},toFormData:function(e){this._to(new a,e,function(e,t,i){e.blob&&e.blob.toBlob?(i.inc(),n(e,function(e,n){t.append(e.name,n,e.file),i.next()})):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob),e.file&&t.append("_"+e.name,e.file)})},toMultipartData:function(t){this._to([],t,function(e,t,i,a){i.inc(),n(e,function(e,n){t.push("--_"+a+'\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+r(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n\r\n"+(e.file?n:r(n))+"\r\n"),i.next()},!0)},e.expando)}},e.Form=o}(FileAPI,window),function(e,t){"use strict";var n=function(){},i=e.document,a=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},o={"":1,XML:1,Text:1,Body:1};a.prototype={status:0,statusText:"",constructor:a,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(i,a){var o=this,r=o.options;o.end=o.abort=n,o.status=i,a&&(o.statusText=a),t.log("xhr.end:",i,a),r.complete(200!=i&&201!=i&&(o.statusText||"unknown"),o),o.xhr&&o.xhr.node&&setTimeout(function(){var t=o.xhr.node;try{t.parentNode.removeChild(t)}catch(e){}try{delete e[o.uid]}catch(e){}e[o.uid]=o.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){e instanceof Error?t.end(0,e.message):(n.upload(n,t),t._send.call(t,n,e))},n)},_send:function(n,a){var r,s=this,l=s.uid,c=s.uid+"Load",d=n.url;if(t.log("XHR._send:",a),n.cache||(d+=(~d.indexOf("?")?"&":"?")+t.uid()),a.nodeName){var u=n.jsonp;d=d.replace(/([a-z]+)=(\?)/i,"$1="+l),n.upload(n,s);var p=function(e){if(~d.indexOf(e.origin))try{var n=t.parseJSON(e.data);n.id==l&&f(n.status,n.statusText,n.response)}catch(e){f(0,e.message)}},f=e[l]=function(n,i,a){s.readyState=4,s.responseText=a,s.end(n,i),t.event.off(e,"message",p),e[l]=r=m=e[c]=null};s.xhr.abort=function(){try{m.stop?m.stop():m.contentWindow.stop?m.contentWindow.stop():m.contentWindow.document.execCommand("Stop")}catch(e){}f(0,"abort")},t.event.on(e,"message",p),e[c]=function(){try{var e=m.contentWindow,n=e.document,i=e.result||t.parseJSON(n.body.innerHTML);f(i.status,i.statusText,i.response)}catch(e){t.log("[transport.onload]",e)}},r=i.createElement("div"),r.innerHTML='<form target="'+l+'" action="'+d+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+l+'" src="javascript:false;" onload="window.'+c+" && "+c+'();"></iframe>'+(u&&n.url.indexOf("=?")<0?'<input value="'+l+'" name="'+u+'" type="hidden"/>':"")+"</form>";var h=r.getElementsByTagName("form")[0],m=r.getElementsByTagName("iframe")[0];h.appendChild(a),t.log(h.parentNode.innerHTML),i.body.appendChild(r),s.xhr.node=r,s.readyState=2;try{h.submit()}catch(e){t.log("iframe.error: "+e)}h=null}else{if(d=d.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted)return void t.log("Error: already aborted");if(r=s.xhr=t.getXHR(),a.params&&(d+=(d.indexOf("?")<0?"?":"&")+a.params.join("&")),r.open("POST",d,!0),t.withCredentials&&(r.withCredentials="true"),n.headers&&n.headers["X-Requested-With"]||r.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){r.setRequestHeader(t,e)}),n._chunked){r.upload&&r.upload.addEventListener("progress",t.throttle(function(e){a.retry||n.progress({type:e.type,total:a.size,loaded:a.start+e.loaded,totalSize:a.size},s,n)},100),!1),r.onreadystatechange=function(){var e=parseInt(r.getResponseHeader("X-Last-Known-Byte"),10);if(s.status=r.status,s.statusText=r.statusText,s.readyState=r.readyState,4==r.readyState){for(var i in o)s["response"+i]=r["response"+i];if(r.onreadystatechange=null,!r.status||r.status-201>0)if(t.log("Error: "+r.status),(!r.status&&!r.aborted||500==r.status||416==r.status)&&++a.retry<=n.chunkUploadRetry){var l=r.status?0:t.chunkNetworkDownRetryTimeout;n.pause(a.file,n),t.log("X-Last-Known-Byte: "+e),e?a.end=e:(a.end=a.start-1,416==r.status&&(a.end=a.end-n.chunkSize)),setTimeout(function(){s._send(n,a)},l)}else s.end(r.status);else a.retry=0,a.end==a.size-1?s.end(r.status):(t.log("X-Last-Known-Byte: "+e),e&&(a.end=e),a.file.FileAPIReadPosition=a.end,setTimeout(function(){s._send(n,a)},0));r=null}},a.start=a.end+1,a.end=Math.max(Math.min(a.start+n.chunkSize,a.size)-1,a.start);var g=a.file,v=(g.slice||g.mozSlice||g.webkitSlice).call(g,a.start,a.end+1);a.size&&!v.size?setTimeout(function(){s.end(-1)}):(r.setRequestHeader("Content-Range","bytes "+a.start+"-"+a.end+"/"+a.size),r.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(a.name)),r.setRequestHeader("Content-Type",a.type||"application/octet-stream"),r.send(v)),g=v=null}else if(r.upload&&r.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,s,n)},100),!1),r.onreadystatechange=function(){if(s.status=r.status,s.statusText=r.statusText,s.readyState=r.readyState,4==r.readyState){for(var e in o)s["response"+e]=r["response"+e];if(r.onreadystatechange=null,!r.status||r.status>201)if(t.log("Error: "+r.status),(!r.status&&!r.aborted||500==r.status)&&(n.retry||0)<n.uploadRetry){n.retry=(n.retry||0)+1;var i=t.networkDownRetryTimeout;n.pause(n.file,n),setTimeout(function(){s._send(n,a)},i)}else s.end(r.status);else s.end(r.status);r=null}},t.isArray(a)){r.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando);var y=a.join("")+"--_"+t.expando+"--";if(r.sendAsBinary)r.sendAsBinary(y);else{var b=Array.prototype.map.call(y,function(e){return 255&e.charCodeAt(0)});r.send(new Uint8Array(b).buffer)}}else r.send(a)}}},t.XHR=a}(window,FileAPI),function(e,t){"use strict";function n(e){return e>=0?e+"px":e}function i(e){var n,i=o.createElement("canvas"),a=!1;try{n=i.getContext("2d"),n.drawImage(e,0,0,1,1),a=255!=n.getImageData(0,0,1,1).data[4]}catch(e){t.log("[FileAPI.Camera] detectVideoSignal:",e)}return a}var a=e.URL||e.webkitURL,o=e.document,r=e.navigator,s=r.getUserMedia||r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia,l=!!s;t.support.media=l;var c=function(e){this.video=e};c.prototype={isActive:function(){return!!this._active},start:function(e){var t,n,o=this,l=o.video,c=function(i){o._active=!i,clearTimeout(n),clearTimeout(t),e&&e(i,o)};s.call(r,{video:!0},function(e){o.stream=e,l.src=a.createObjectURL(e),t=setInterval(function(){i(l)&&c(null)},1e3),n=setTimeout(function(){c("timeout")},5e3),l.play()},c)},stop:function(){try{this._active=!1,this.video.pause();try{this.stream.stop()}catch(e){t.each(this.stream.getTracks(),function(e){e.stop()})}this.stream=null}catch(e){t.log("[FileAPI.Camera] stop:",e)}},shot:function(){return new d(this.video)}},c.get=function(e){return new c(e.firstChild)},c.publish=function(i,a,r){"function"==typeof a&&(r=a,a={}),a=t.extend({},{width:"100%",height:"100%",start:!0},a),i.jquery&&(i=i[0]);var s=function(e){if(e)r(e);else{var t=c.get(i);a.start?t.start(r):r(null,t)}};if(i.style.width=n(a.width),i.style.height=n(a.height),t.html5&&l){var d=o.createElement("video");d.style.width=n(a.width),d.style.height=n(a.height),e.jQuery?jQuery(i).empty():i.innerHTML="",i.appendChild(d),s()}else c.fallback(i,a,s)},c.fallback=function(e,t,n){n("not_support_camera")};var d=function(e){var n=e.nodeName?t.Image.toCanvas(e):e,i=t.Image(n);return i.type="image/png",i.width=n.width,i.height=n.height,i.size=n.width*n.height*4,i};c.Shot=d,t.Camera=c}(window,FileAPI),function(e,t,n){"use strict";var i=e.document,a=e.location,o=e.navigator,r=n.each;n.support.flash=function(){var t=o.mimeTypes,i=!1;if(o.plugins&&"object"==typeof o.plugins["Shockwave Flash"])i=o.plugins["Shockwave Flash"].description&&!(t&&t["application/x-shockwave-flash"]&&!t["application/x-shockwave-flash"].enabledPlugin);else try{i=!(!e.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){n.log("Flash -- does not supported.")}return i&&/^file:/i.test(a)&&n.log("[warn] Flash does not work on `file:` protocol."),i}(),n.support.flash&&(!n.html5||!n.support.html5||n.cors&&!n.support.cors||n.media&&!n.support.media)&&function(){function s(e){
return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(t,n){return e[n]})}function l(e,t){if(e&&e.style){var n,i;for(n in t){i=t[n],"number"==typeof i&&(i+="px");try{e.style[n]=i}catch(e){}}}}function c(e,t){r(t,function(t,n){var i=e[n];e[n]=function(){return this.parent=i,t.apply(this,arguments)}})}function d(e){return e&&!e.flashId}function u(e){var t=e.wid=n.uid();return x._fn[t]=e,"FileAPI.Flash._fn."+t}function p(e){try{x._fn[e.wid]=null,delete x._fn[e.wid]}catch(e){}}function f(e,t){if(!w.test(e)){if(/^\.\//.test(e)||"/"!=e.charAt(0)){var n=a.pathname;n=n.substr(0,n.lastIndexOf("/")),e=(n+"/"+e).replace("/./","/")}"//"!=e.substr(0,2)&&(e="//"+a.host+e),w.test(e)||(e=a.protocol+e)}return t&&(e+=(/\?/.test(e)?"&":"?")+t),e}function h(e,t,a){function o(){try{x.get(c).setImage(t)}catch(e){n.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',e)}}var r,c=n.uid(),d=i.createElement("div"),h=10;for(r in e)d.setAttribute(r,e[r]),d[r]=e[r];l(d,e),e.width="100%",e.height="100%",d.innerHTML=s(n.extend({id:c,src:f(n.flashImageUrl,"r="+n.uid()),wmode:"opaque",flashvars:"scale="+e.scale+"&callback="+u(function e(){return p(e),--h>0&&o(),!0})},e)),a(!1,d),d=null}function m(e){return{id:e.id,name:e.name,matrix:e.matrix,flashId:e.flashId}}function g(t){var n=t.getBoundingClientRect(),a=i.body,o=(t&&t.ownerDocument).documentElement;return{top:n.top+(e.pageYOffset||o.scrollTop)-(o.clientTop||a.clientTop||0),left:n.left+(e.pageXOffset||o.scrollLeft)-(o.clientLeft||a.clientLeft||0),width:n.right-n.left,height:n.bottom-n.top}}var v=n.uid(),y=0,b={},w=/^https?:/i,x={_fn:{},init:function(){var e=i.body&&i.body.firstChild;if(e)do{if(1==e.nodeType){n.log("FlashAPI.state: awaiting");var t=i.createElement("div");return t.id="_"+v,l(t,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:"2147483647"}),e.parentNode.insertBefore(t,e),void x.publish(t,v)}}while(e=e.nextSibling);y<10&&setTimeout(x.init,50*++y)},publish:function(e,t,i){i=i||{},e.innerHTML=s({id:t,src:f(n.flashUrl,"r="+n.version),wmode:i.camera?"":"transparent",flashvars:"callback="+(i.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+t+"&storeKey="+o.userAgent.match(/\d/gi).join("")+"_"+n.version+(x.isReady||(n.pingUrl?"&ping="+n.pingUrl:""))+"&timeout="+n.flashAbortTimeout+(i.camera?"&useCamera="+f(n.flashWebcamUrl):"")+"&debug="+(n.debug?"1":"")},i)},ready:function(){n.log("FlashAPI.state: ready"),x.ready=n.F,x.isReady=!0,x.patch(),x.patchCamera&&x.patchCamera(),n.event.on(i,"mouseover",x.mouseover),n.event.on(i,"click",function(e){x.mouseover(e)&&(e.preventDefault?e.preventDefault():e.returnValue=!0)})},getEl:function(){return i.getElementById("_"+v)},getWrapper:function(e){do{if(/js-fileapi-wrapper/.test(e.className))return e}while((e=e.parentNode)&&e!==i.body)},mouseover:function(e){var t=n.event.fix(e).target;if(/input/i.test(t.nodeName)&&"file"==t.type&&!t.disabled){var a=t.getAttribute(v),o=x.getWrapper(t);if(n.multiFlash){if("i"==a||"r"==a)return!1;if("p"!=a){t.setAttribute(v,"i");var r=i.createElement("div");if(!o)return void n.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");l(r,{top:0,left:0,width:t.offsetWidth,height:t.offsetHeight,zIndex:"2147483647",position:"absolute"}),o.appendChild(r),x.publish(r,n.uid()),t.setAttribute(v,"p")}return!0}if(o){var s=g(o);l(x.getEl(),s),x.curInp=t}}else/object|embed/i.test(t.nodeName)||l(x.getEl(),{top:1,left:1,width:5,height:5})},onEvent:function(e){var t=e.type;if("ready"==t){try{x.getInput(e.flashId).setAttribute(v,"r")}catch(e){}return x.ready(),setTimeout(function(){x.mouseenter(e)},50),!0}"ping"===t?n.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):"log"===t?n.log("(flash -> js).log:",e.target):t in x&&setTimeout(function(){n.log("FlashAPI.event."+e.type+":",e),x[t](e)},1)},mouseenter:function(e){var t=x.getInput(e.flashId);if(t){x.cmd(e,"multiple",null!=t.getAttribute("multiple"));var i=[],a={};r((t.getAttribute("accept")||"").split(/,\s*/),function(e){n.accept[e]&&r(n.accept[e].split(" "),function(e){a[e]=1})}),r(a,function(e,t){i.push(t)}),x.cmd(e,"accept",i.length?i.join(",")+","+i.join(",").toUpperCase():"*")}},get:function(t){return i[t]||e[t]||i.embeds[t]},getInput:function(e){if(!n.multiFlash)return x.curInp;try{var t=x.getWrapper(x.get(e));if(t)return t.getElementsByTagName("input")[0]}catch(t){n.log('[err] Can not find "input" by flashId:',e,t)}},select:function(e){var a,o=x.getInput(e.flashId),s=n.uid(o),l=e.target.files;r(l,function(e){n.checkFileObj(e)}),b[s]=l,i.createEvent?(a=i.createEvent("Event"),a.files=l,a.initEvent("change",!0,!0),o.dispatchEvent(a)):t?t(o).trigger({type:"change",files:l}):(a=i.createEventObject(),a.files=l,o.fireEvent("onchange",a))},cmd:function(e,t,i,a){try{return n.log("(js -> flash)."+t+":",i),x.get(e.flashId||e).cmd(t,i)}catch(o){n.log("(js -> flash).onError:",o.toString()),a||setTimeout(function(){x.cmd(e,t,i,!0)},50)}},patch:function(){n.flashEngine=!0,c(n,{getFiles:function(e,t,i){if(i)return n.filterFiles(n.getFiles(e),t,i),null;var a=n.isArray(e)?e:b[n.uid(e.target||e.srcElement||e)];return a?(t&&(t=n.getFilesFilter(t),a=n.filter(a,function(e){return t.test(e.name)})),a):this.parent.apply(this,arguments)},getInfo:function(e,t){if(d(e))this.parent.apply(this,arguments);else if(e.isShot)t(null,e.info={width:e.width,height:e.height});else{if(!e.__info){var i=e.__info=n.defer();x.cmd(e,"getFileInfo",{id:e.id,callback:u(function t(n,a){p(t),i.resolve(n,e.info=a)})})}e.__info.then(t)}}}),n.support.transform=!0,n.Image&&c(n.Image.prototype,{get:function(e,t){return this.set({scaleMode:t||"noScale"}),this.parent(e)},_load:function(e,t){if(n.log("FlashAPI.Image._load:",e),d(e))this.parent.apply(this,arguments);else{var i=this;n.getInfo(e,function(n){t.call(i,n,e)})}},_apply:function(e,t){if(n.log("FlashAPI.Image._apply:",e),d(e))this.parent.apply(this,arguments);else{var i=this.getMatrix(e.info),a=t;x.cmd(e,"imageTransform",{id:e.id,matrix:i,callback:u(function o(r,s){n.log("FlashAPI.Image._apply.callback:",r),p(o),r?a(r):n.support.html5||n.support.dataURI&&!(s.length>3e4)?(i.filter&&(a=function(e,a){e?t(e):n.Image.applyFilter(a,i.filter,function(){t(e,this.canvas)})}),n.newImage("data:"+e.type+";base64,"+s,a)):h({width:i.deg%180?i.dh:i.dw,height:i.deg%180?i.dw:i.dh,scale:i.scaleMode},s,a)})})}},toData:function(e){var t=this.file,i=t.info,a=this.getMatrix(i);n.log("FlashAPI.Image.toData"),d(t)?this.parent.apply(this,arguments):("auto"==a.deg&&(a.deg=n.Image.exifOrientation[i&&i.exif&&i.exif.Orientation]||0),e.call(this,!t.info,{id:t.id,flashId:t.flashId,name:t.name,type:t.type,matrix:a}))}}),n.Image&&c(n.Image,{fromDataURL:function(e,t,i){!n.support.dataURI||e.length>3e4?h(n.extend({scale:"exactFit"},t),e.replace(/^data:[^,]+,/,""),function(e,t){i(t)}):this.parent(e,t,i)}}),c(n.Form.prototype,{toData:function(e){for(var t=this.items,i=t.length;i--;)if(t[i].file&&d(t[i].blob))return this.parent.apply(this,arguments);n.log("FlashAPI.Form.toData"),e(t)}}),c(n.XHR.prototype,{_send:function(e,t){if(t.nodeName||t.append&&n.support.html5||n.isArray(t)&&"string"==typeof t[0])return this.parent.apply(this,arguments);var i,a,o={},s={},l=this;if(r(t,function(e){e.file?(s[e.name]=e=m(e.blob),a=e.id,i=e.flashId):o[e.name]=e.blob}),a||(i=v),!i)return n.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);n.log("FlashAPI.XHR._send: "+i+" -> "+a),l.xhr={headers:{},abort:function(){x.cmd(i,"abort",{id:a})},getResponseHeader:function(e){return this.headers[e]},getAllResponseHeaders:function(){return this.headers}};var c=n.queue(function(){x.cmd(i,"upload",{url:f(e.url.replace(/([a-z]+)=(\?)&?/i,"")),data:o,files:a?s:null,headers:e.headers||{},callback:u(function t(i){var a=i.type,o=i.result;n.log("FlashAPI.upload."+a),"progress"==a?(i.loaded=Math.min(i.loaded,i.total),i.lengthComputable=!0,e.progress(i)):"complete"==a?(p(t),"string"==typeof o&&(l.responseText=o.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),l.end(i.status||200)):"abort"!=a&&"error"!=a||(l.end(i.status||0,i.message),p(t))})})});r(s,function(e){c.inc(),n.getInfo(e,c.next)}),c.check()}})}};n.Flash=x,n.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(e,t){n.support.dataURI=!(1!=t.width||1!=t.height),x.init()})}()}(window,window.jQuery,FileAPI),function(e,t,n){"use strict";var i=n.each,a=[];!n.support.flash||!n.media||n.support.media&&n.html5||function(){function e(e){var t=e.wid=n.uid();return n.Flash._fn[t]=e,"FileAPI.Flash._fn."+t}function t(e){try{n.Flash._fn[e.wid]=null,delete n.Flash._fn[e.wid]}catch(e){}}var o=n.Flash;n.extend(n.Flash,{patchCamera:function(){n.Camera.fallback=function(i,a,r){var s=n.uid();n.log("FlashAPI.Camera.publish: "+s),o.publish(i,s,n.extend(a,{camera:!0,onEvent:e(function e(i){"camera"===i.type&&(t(e),i.error?(n.log("FlashAPI.Camera.publish.error: "+i.error),r(i.error)):(n.log("FlashAPI.Camera.publish.success: "+s),r(null)))})}))},i(a,function(e){n.Camera.fallback.apply(n.Camera,e)}),a=[],n.extend(n.Camera.prototype,{_id:function(){return this.video.id},start:function(i){var a=this;o.cmd(this._id(),"camera.on",{callback:e(function e(o){t(e),o.error?(n.log("FlashAPI.camera.on.error: "+o.error),i(o.error,a)):(n.log("FlashAPI.camera.on.success: "+a._id()),a._active=!0,i(null,a))})})},stop:function(){this._active=!1,o.cmd(this._id(),"camera.off")},shot:function(){n.log("FlashAPI.Camera.shot:",this._id());var e=n.Flash.cmd(this._id(),"shot",{});return e.type="image/png",e.flashId=this._id(),e.isShot=!0,new n.Camera.Shot(e)}})}}),n.Camera.fallback=function(){a.push(arguments)}}()}(window,window.jQuery,FileAPI),"function"==typeof define&&define.amd&&define("FileAPI",[],function(){return FileAPI}),function(e,t){"use strict";var n=e.noop,i=!e.fn.prop,a=i?"attr":"prop",o="data-fileapi",r="data-fileapi-id",s=function(i,a){if(this.$el=i=e(i).on("change.fileapi",e.proxy(this,"_onSelect")),this.el=i[0],this._options={},this.options=a=e.extend({url:0,data:{},accept:0,multiple:!1,paramName:0,dataType:"json",duplicate:!1,chunkSize:0,chunkUploadRetry:3,maxSize:0,maxFiles:0,imageSize:0,sortFn:0,filterFn:0,autoUpload:!1,lang:{B:"bytes",KB:"KB",MB:"MB",GB:"GB",TB:"TB"},sizeFormat:"0.00",imageTransform:0,elements:{ctrl:{upload:'[data-fileapi="ctrl.upload"]',reset:'[data-fileapi="ctrl.reset"]',abort:'[data-fileapi="ctrl.abort"]'},empty:{show:'[data-fileapi="empty.show"]',hide:'[data-fileapi="empty.hide"]'},emptyQueue:{show:'[data-fileapi="emptyQueue.show"]',hide:'[data-fileapi="emptyQueue.hide"]'},active:{show:'[data-fileapi="active.show"]',hide:'[data-fileapi="active.hide"]'},size:'[data-fileapi="size"]',name:'[data-fileapi="name"]',progress:'[data-fileapi="progress"]',file:{tpl:'[data-fileapi="file.tpl"]',progress:'[data-fileapi="file.progress"]',active:{show:'[data-fileapi="active.show"]',hide:'[data-fileapi="active.hide"]'},preview:{el:0,get:0,width:0,height:0,processing:0}},dnd:{el:'[data-fileapi="dnd"]',hover:"dnd_hover"}},onDrop:n,onDropHover:n,onSelect:n,onUpload:n,onProgress:n,onComplete:n,onFileUpload:n,onFileProgress:n,onFileComplete:n},a),!a.url){var r=this.$el.attr("action")||this.$el.find("form").attr("action");r?a.url=r:this._throw("url \u2014 is not defined")}this.$files=this.elem("list"),this.itemTplFn=e.fn.fileapi.tpl(e("<div/>").append(this.elem("file.tpl")).html()),t.each(a,function(e,t){this._setOption(t,e)},this),this.$el.on("reset.fileapi",e.proxy(this,"_onReset")).on("submit.fileapi",e.proxy(this,"_onSubmit")).on("upload.fileapi progress.fileapi complete.fileapi",e.proxy(this,"_onUploadEvent")).on("fileupload.fileapi fileprogress.fileapi filecomplete.fileapi",e.proxy(this,"_onFileUploadEvent")).on("click","["+o+"]",e.proxy(this,"_onActionClick"));var s=a.elements.ctrl;s&&(s.reset&&this.$el.on("click.fileapi",s.reset,e.proxy(this,"_onReset")),s.upload&&this.$el.on("click.fileapi",s.upload,e.proxy(this,"_onSubmit"))),this.elem("dnd.el",!0).dnd(e.proxy(this,"_onDropHover"),e.proxy(this,"_onDrop")),this.$progress=this.elem("progress"),this._crop={},this._rotate={},this.files=[],this.uploaded=[],this.clear()};s.prototype={constructor:s,_throw:function(e){throw"jquery.fileapi: "+e},_getFiles:function(e,n){var i=this.options,a=i.maxSize,o=i.filterFn,r=t.getFiles(e),s={all:r,files:[],other:[],duplicate:i.duplicate?[]:this._extractDuplicateFiles(r)},l=i.imageSize,c=this;l||o?t.filterFiles(r,function(e,t){var n=!0;return t&&l&&(n=(!l.minWidth||t.width>=l.minWidth)&&(!l.minHeight||t.height>=l.minHeight)&&(!l.maxWidth||t.height<=l.maxWidth)&&(!l.maxHeight||t.height<=l.maxHeight)),n&&(!a||a>=e.size)&&(!o||o(e,t))},function(e,t){s.files=e,s.other=t,n.call(c,s)}):(t.each(r,function(e){s[!a||a>=e.size?"files":"other"].push(e)}),n.call(c,s))},_extractDuplicateFiles:function(e){for(var t,n=[],i=e.length,a=this.files;i--;)for(t=a.length;t--;)if(this._fileCompare(e[i],a[t])){n.push(e.splice(i,1));break}return n},_fileCompare:function(e,t){return e.size==t.size&&e.name==t.name},_getFormatedSize:function(e){var n=this.options,i="B";return e>=t.TB?e/=t[i="TB"]:e>=t.GB?e/=t[i="GB"]:e>=t.MB?e/=t[i="MB"]:e>=t.KB&&(e/=t[i="KB"]),n.sizeFormat.replace(/^\d+([^\d]+)(\d*)/,function(t,a,o){return e=e.toFixed(o.length),(e+"").replace(".",a)+" "+n.lang[i]})},_onSelect:function(t){this._getFiles(t,e.proxy(function(e){e.all.length&&!1!==this.emit("select",e)&&this.add(e.files)},this))},_onActionClick:function(n){var i=n.currentTarget,a=e.attr(i,o),s=e(i).closest("["+r+"]",this.$el),l=s.attr(r),c=!0;"remove"==a?(s.remove(),this.queue=t.filter(this.queue,function(e){return t.uid(e)!=l}),this.files=t.filter(this.files,function(e){return t.uid(e)!=l}),this._redraw()):/^rotate/.test(a)?this.rotate(l,/ccw/.test(a)?"-=90":"+=90"):c=!1,c&&n.preventDefault()},_onSubmit:function(e){this.upload(),e.preventDefault()},_onReset:function(e){this.clear(),e.preventDefault()},_onDrop:function(e){this._getFiles(e,function(e){!1!==this.emit("drop",e)&&this.add(e.files)})},_onDropHover:function(t,n){if(!1!==this.emit("dropHover",{state:t,event:n})){var i=this.option("elements.dnd.hover");i&&e(n.currentTarget).toggleClass(i,t)}},_getUploadEvent:function(t){var n=this.xhr,i={xhr:n,file:n.currentFile,files:n.files,widget:this};return e.extend(i,t)},_emitUploadEvent:function(e){var t=this._getUploadEvent();this.emit(e+"upload",t)},_emitProgressEvent:function(e,t){var n=this._getUploadEvent(t);this.emit(e+"progress",n)},_emitCompleteEvent:function(t,n){var i=this.xhr,a=this._getUploadEvent({error:n,status:i.status,statusText:i.statusText,result:i.responseText});"json"==this.options.dataType&&(a.result=e.parseJSON(a.result)),this.emit(t+"complete",a)},_onUploadEvent:function(e,t){var n=this,i=this.$progress,a=e.type;if("progress"==a)i.stop().animate({width:t.loaded/t.total*100+"%"},300);else if("upload"==a)i.width(0);else{var o=function(){i.dequeue(),n.clear()};this.xhr=null,this.active=!1,i.length?i.queue(o):o()}},_onFileUploadPrepare:function(n,i){var a=t.uid(n),o=this._rotate[a],r=this._crop[a];if(o||r){var s=i.imageTransform=i.imageTransform||{};e.isEmptyObject(s)||parseInt(s.maxWidth||s.minWidth||s.width,10)>0||s.type||s.quality?(s.crop=r,s.rotate=o):t.each(s,function(e){e.crop=r,e.rotate=o})}},_onFileUploadEvent:function(e,n){var i=this,a=e.type.substr(4),r=t.uid(n.file),s=this.fileElem(r),l=this._$fileprogress;if(this.__fileId!==r&&(this.__fileId=r,this._$fileprogress=l=s.find(this.option("elements.file.progress"))),"progress"==a)l.stop().animate({width:n.loaded/n.total*100+"%"},300);else if("upload"==a||"complete"==a){var c=function(){var e="elements.file."+a;"upload"==a&&(s.find("["+o+'="remove"]').hide(),l.width(0)),l.dequeue(),s.find(i.option(e+".show")).show(),s.find(i.option(e+".hide")).hide()};l.length?l.queue(c):c(),"complete"==a&&(this.uploaded.push(n.file),delete this._rotate[r])}},_redraw:function(){var n=!!this.active,i=this.files,o=!i.length&&!n,s=!this.queue.length&&!n,l=[],c=0,d=this.$files,u=d.children().length,p=this.option("elements.file.preview");t.each(i,function(n,i){var a=t.uid(n);if(l.push(n.name),c+=n.size,d.length&&!this.fileElem(a).length){var o=this.itemTplFn({$idx:u+i,uid:n.uid,name:n.name,type:n.type,size:n.size,sizeText:this._getFormatedSize(n.size)});d.append(e(o).attr(r,a)),p.el&&this._makeFilePreview(a,n,p)}},this),this.elem("name").text(l.join(", ")),this.elem("size").text(this._getFormatedSize(c)),this.__empty!==o&&(this.__empty=o,this.elem("empty.show").toggle(o),this.elem("empty.hide").toggle(!o)),this.__emptyQueue!==s&&(this.__emptyQueue=o,this.elem("emptyQueue.show").toggle(s),this.elem("emptyQueue.hide").toggle(!s)),this.__active!==n&&(this.__active=n,this.elem("active.show").toggle(n),this.elem("active.hide").toggle(!n),this.$(".js-fileapi-wrapper,:file")[n?"attr":"removeAttr"]("aria-disabled",n)[a]("disabled",n)),this.elem("ctrl.upload").add(this.elem("ctrl.reset"))[o||n?"attr":"removeAttr"]("aria-disabled",o||n)[a]("disabled",o||n)},_makeFilePreview:function(e,n,i,a){var o=this,r=a?o.$(i.el):o.fileElem(e).find(i.el);if(/^image/.test(n.type)){t.log("_makeFilePreview:",e,n);var s=t.Image(n),l=function(){s.get(function(t,a){o._crop[e]||(t?(i.get&&i.get(r,n),o.emit("filePreviewError",{error:t,file:n})):r.html(a))})};i.width&&s.preview(i.width,i.height),i.rotate&&s.rotate(i.rotate),i.processing?i.processing(n,s,l):l()}else i.get&&i.get(r,n)},emit:function(t,n){var i,a=this.options,o=e.Event(t);return o.widget=this,t=e.camelCase("on-"+t.replace(/(file)(upload)/,"$1-$2")),e.isFunction(a[t])&&(i=a[t].call(this.el,o,n)),!1!==i&&this.$el.triggerHandler(o,n)},add:function(e){if(e.length){var n=this.options,i=n.sortFn,a=n.elements.preview;i&&e.sort(i),a&&a.el&&t.each(e,function(e){this._makeFilePreview(t.uid(e),e,a,!0)},this),this.xhr&&this.xhr.append(e),this.queue=this.queue.concat(e),this.files=this.files.concat(e),this.options.autoUpload?this.upload():this._redraw()}},$:function(t,n){return"string"==typeof t&&(t=/^#/.test(t)?t:(n?e(n):this.$el).find(t)),e(t)},elem:function(t,n){var i=this.option("elements."+t);return void 0===i&&n&&(i=this.option("elements."+t.substr(0,t.lastIndexOf(".")))),this.$("string"!=e.type(i)&&e.isEmptyObject(i)?[]:i)},fileElem:function(e){return this.$("["+r+'="'+e+'"]')},option:function(n,i){if(void 0!==i&&e.isPlainObject(i))return t.each(i,function(e,t){this.option(n+"."+t,e)},this),this;var a,o,r=this.options,s=r[n],l=0;if(-1!=n.indexOf("."))for(s=r,n=n.split("."),a=n.length;a>l;l++){if(o=n[l],void 0!==i&&1==a-l){s[o]=i;break}void 0===s[o]&&(s[o]={}),s=s[o]}else void 0!==i&&(r[n]=i);return void 0!==i&&(this._setOption(n,i,this._options[n]),this._options[n]=i),void 0!==i?i:s},_setOption:function(e,t){switch(e){case"accept":case"multiple":case"paramName":"paramName"==e&&(e="name"),t&&this.$(":file")[a](e,t)}},serialize:function(){var t,n={};return this.$el.find(":input").each(function(i,a){(i=a.name)&&!a.disabled&&(a.checked||/select|textarea|input/i.test(a.nodeName)&&/checkbox|radio/i.test(a.type))&&(t=e(a).val(),void 0!==n[i]?(n[i].push||(n[i]=[n[i]]),n[i].push(t)):n[i]=t)}),n},upload:function(){if(!this.active){this.active=!0;var n=this.$el,i=this.options,a={},o={url:i.url,data:e.extend({},this.serialize(),i.data),files:a,chunkSize:0|i.chunkSize,chunkUploadRetry:0|i.chunkUploadRetry,prepare:e.proxy(this,"_onFileUploadPrepare"),imageTransform:i.imageTransform};a[n.find(":file").attr("name")||"files[]"]=this.queue,t.each(["upload","progress","complete"],function(t){o[t]=e.proxy(this,e.camelCase("_emit-"+t+"Event"),""),o["file"+t]=e.proxy(this,e.camelCase("_emit-"+t+"Event"),"file")},this),this.xhr=t.upload(o),this._redraw()}},crop:function(n,i){var a=t.uid(n),o=this.options,r=o.multiple?this.option("elements.file.preview"):o.elements.preview,s=(o.multiple?this.fileElem(a):this.$el).find(r&&r.el);s.length&&t.getInfo(n,e.proxy(function(a,o){if(!a){s.find("div>div").length||s.html(e("<div><div></div></div>").css(r).css("overflow","hidden")),this.__cropFile!==n&&(this.__cropFile=n,t.Image(n).get(function(t,n){s.find(">div>div").html(e(n).width("100%").height("100%"))},"exactFit"));var l=r.width/i.w,c=r.height/i.h;s.find(">div>div").css({width:Math.round(l*o.width),height:Math.round(c*o.height),marginLeft:-Math.round(l*i.x),marginTop:-Math.round(c*i.y)})}},this)),this._crop[a]=i},rotate:function(e,n){var i="object"==typeof e?t.uid(e):e,a=this.options,o=a.multiple?this.option("elements.file.preview"):a.elements.preview,r=(a.multiple?this.fileElem(i):this.$el).find(o&&o.el),s=this._rotate;/([+-])=/.test(n)?n=s[i]=(s[i]||0)+("+"==RegExp.$1?1:-1)*n.substr(2):s[i]=n,r.css({"-webkit-transform":"rotate("+n+"deg)","-moz-transform":"rotate("+n+"deg)",transform:"rotate("+n+"deg)"})},clear:function(){this.queue=[],this._redraw()},widget:function(){return this},destroy:function(){this.$el.off(".fileapi").removeData("fileapi")}},e.fn.fileapi=function(t,n){var i=this.data("fileapi");if(i){if("widget"===t)return i;if("string"==typeof t){var a,o=i[t];return e.isFunction(o)?a=o.call(i,n,arguments[2]):void 0===o&&(a=this.option(t,n)),void 0===a?this:a}}else this.data("fileapi",new s(this,t));return this},e.fn.fileapi.version="0.1.0",e.fn.fileapi.tpl=function(e){var t=0,n="__b+='";return e.replace(/(?:&lt;|<)%([-=])?([\s\S]+?)%(?:&gt;|>)|$/g,function(i,a,o,r){return n+=e.slice(t,r).replace(/[\r\n"']/g,function(e){return"\\"+e}),o&&(n+=a?"'+\n((__x=("+o+"))==null?'':"+("-"==a?"__esc(__x)":"__x")+")\n+'":"';\n"+o+"\n__b+='"),t=r+i.length,i}),Function("ctx","var __x,__b='',__esc=function(val){return typeof val=='string'?val.replace(/</g,'&lt;').replace(/\"/g,'&quot;'):val;};with(ctx||{}){\n"+n+"';\n}return __b;")},e.fn.cropper=function(n){var i=this,a=n.file;return"string"==typeof n?i.Jcrop(n):t.getInfo(a,function(o,r){var s=t.Image(a);n.maxSize&&s.resize(n.maxSize[0],n.maxSize[1],"max"),s.get(function(a,o){n.setSelect=n.setSelect||[0,0,o.width,o.height],t.each(["onSelect","onChange"],function(e,t){(t=n[e])&&(n[e]=function(e){var n=r.width/o.width,i=r.height/o.height;t({x:0|e.x*n+.5,y:0|e.y*i+.5,w:0|e.w*n+.5,h:0|e.h*i+.5})})}),i.css("lineHeight",0).html(e(o).css("margin",0)).trigger("resize").Jcrop("destroy").Jcrop(n)})}),i}}(jQuery,FileAPI),function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates["amazon_assets/attached_file"]=Handlebars.template({1:function(e,t,n,i){var a;return"    <div class='attachments-fields-item-size'>"+this.escapeExpression((a=null!=(a=t.fullSize||(null!=e?e.fullSize:e))?a:t.helperMissing,"function"==typeof a?a.call(e,{name:"fullSize",hash:{},data:i}):a))+"</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a,o;return"<div class='attachments-fields-item js-file-item'>\n  <div class='attachments-fields-icon "+this.escapeExpression((o=null!=(o=t.ext||(null!=e?e.ext:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{name:"ext",hash:{},data:i}):o))+"'></div>\n  <div class='attachments-fields-item-content'>\n    <div class='attachments-fields-item-title'>"+this.escapeExpression((o=null!=(o=t.name||(null!=e?e.name:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{name:"name",hash:{},data:i}):o))+"</div>\n"+(null!=(a=t["if"].call(e,null!=e?e.fullSize:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?a:"")+"  </div>\n  <div class='attachments-fields-icon delete js-detach-file' data-file-field-name='"+this.escapeExpression((o=null!=(o=t.fileFieldName||(null!=e?e.fileFieldName:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{name:"fileFieldName",hash:{},data:i}):o))+"' title='\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0444\u0430\u0439\u043b'></div>\n  <input disabled name='"+this.escapeExpression((o=null!=(o=t.destroyFieldName||(null!=e?e.destroyFieldName:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{name:"destroyFieldName",hash:{},data:i}):o))+"' type='hidden' value='1'>\n  <input disabled name='"+this.escapeExpression((o=null!=(o=t.idFieldName||(null!=e?e.idFieldName:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{name:"idFieldName",hash:{},data:i}):o))+"' type='hidden' value='"+this.escapeExpression((o=null!=(o=t.id||(null!=e?e.id:e))?o:t.helperMissing,"function"==typeof o?o.call(e,{name:"id",hash:{},data:i}):o))+"'>\n</div>"},useData:!0}),this.HandlebarsTemplates["amazon_assets/attached_file"]}.call(this),app.modules.attachmentsFields=function(e){function t(e){m.find(".js-error-message-format").toggleClass("dn",!e||g).end().find(".js-error-message-size").toggleClass("dn",!e||!e.size||v)}function n(e){return Math.round(2*(e<FileAPI.KB?e:e/(e>FileAPI.MB?FileAPI.MB:FileAPI.KB)))/2+m.data("units-of-measure")[e<FileAPI.KB?"byte":e>FileAPI.MB?"MB":"KB"]}function i(e){m.find(".js-attached-files").append(HandlebarsTemplates["amazon_assets/attached_file"](e))}function a(e,t){return m.data("name-template").replace("%index%",t).replace("%type%",e)}function o(e){$.each(e,function(e,t){i({name:t.origin_file_name,ext:r(t.origin_file_name).toLowerCase(),fullSize:n(t.local_file_size),id:t.id,type:t.local_content_type,idFieldName:a("id",e),destroyFieldName:a("_destroy",e),fileFieldName:a("local",e),index:e})})}function r(e){return e.split(".").pop()}function s(e){var t=m.data("permitted-types");return g=!t||new RegExp(t.join("|").toLowerCase()).test(e.type.toLowerCase()),v=e.size<m.data("max-size")*FileAPI.MB,g&&(!e.size||v)}function l(){m.find(".js-attach-file").toggleClass("disabled",m.find(".js-file-item:visible").length===m.data("max-count"))}function c(e,t){e.after(e.clone(!0).attr({name:a("local",t)}).val("")).hide()}function d(e){return e.index=m.find(".js-file-item").length||0,e.ext=r(e.name).toLowerCase(),e.fullSize=e.size&&n(e.size),e.fileFieldName=a("local",e.index),e}function u(e){e.closest(".js-file-item").hide().find('[type="hidden"]').prop({disabled:!1}),m.find('[name="'+e.data("file-field-name")+'"]').prop({disabled:!0})}function p(e){return m.is("[data-required]")?m.find(".js-file-item:visible").length?e.resolve():e.reject():e.resolve(),e}function f(e){m.find(".js-error-message-required-field").toggleClass("dn",!e)}function h(){FileAPI.event.on(m.find(".js-attach-file-button")[0],"change",function(e){var n=FileAPI.getFiles(e),a=$(e.target);t(),FileAPI.filterFiles(n,s,function(e,n){if(e.length){var o=d(e[0]);i(o),c(a,++o.index),$doc.trigger("attachFile:attachAndDetachFile",[a]),f()}else t(n.length?n[0]:{}),a.val(""),$doc.trigger("error:attachAndDetachFile");l()})}),m.on("click",".js-detach-file",function(){var e=$(this);u(e),l(),t(),$doc.trigger("detachFile:attachAndDetachFile",[e])}).on("validateComponent:attachmentsFields",function(e,t){p(t).done(function(){f(!1)}).fail(function(){f(!0)})}).on("click",".js-attach-file-button",function(){$doc.trigger("browseFiles:attachAndDetachFile",[$(this)])})}var m,g,v;return e.load=function(){m=$(".js-attachments-fields");var e=m.data("attached-files");e&&o(e),h()},e}(app.modules.attachmentsFields||{}),function(){return this.HandlebarsTemplates||(this.HandlebarsTemplates={}),this.HandlebarsTemplates.region_confirmation=Handlebars.template({1:function(e){var t;return"  <div class='rc-question'>\u0412\u0430\u0448 \u0433\u043e\u0440\u043e\u0434 "+this.escapeExpression(this.lambda(null!=(t=null!=e?e.region:e)?t.name:t,e))+"?</div>\n  <div class='rc-actions'>\n    <button class='modern-button filled js-rc-agree'>\u0414\u0430</button>\n    <div class='pseudo-link modern js-show-region-panel js-rc-close'>\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0434\u0440\u0443\u0433\u043e\u0439</div>\n  </div>\n"},3:function(){return"  <div class='rc-question'>\u0423\u0442\u043e\u0447\u043d\u0438\u0442\u0435 \u0432\u0430\u0448 \u0440\u0435\u0433\u0438\u043e\u043d</div>\n  <div class='rc-actions'>\n    <button class='modern-button filled js-show-region-panel js-rc-close'>\u0412\u044b\u0431\u0440\u0430\u0442\u044c</button>\n    <button class='modern-button secondary js-rc-close'>\u041d\u0435 \u0441\u0435\u0439\u0447\u0430\u0441</button>\n  </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var a;return"<div class='region-confirmation'>\n"+(null!=(a=t["if"].call(e,null!=e?e.region:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?a:"")+"</div>"},useData:!0}),this.HandlebarsTemplates.region_confirmation}.call(this),app.modules.userRegion=function(e){function t(){s=$(HandlebarsTemplates.region_confirmation({region:app.config.regions.currentRegionByIP})),r.append(s)}function n(e,t){var n=t?t.capital_id:app.config.regions.currentRegionByIP.capital_id;app.config.currentUser.id?$.ajax({url:app.config.api.updateUserURL.replace("_id_",app.config.currentUser.id),method:"PUT",data:{profile_attributes:{city_id:n}}}).then(function(){location.reload(!0)}):($.cookie("home_city_id",n,{expires:90}),location.reload(!0))}function i(){s.remove()}function a(){$doc.on("click",".js-rc-agree",n).on("click",".js-rc-close",i).on("chooseCity:selectRegion",n)}function o(){r=$(".js-show-region-panel-container"),t()}var r,s;return e.load=function(){var e;if(!app.config.currentUser.cityId){if(e=$.cookie("home_city_id"),app.config.currentUser.id&&!app.config.currentUser.cityId&&e)return n(null,{capital_id:+e}),void $.cookie("home_city_id",null);app.config.regions&&(o(),a())}},e}(app.modules.userRegion||{}),app.modules.sendAnalyticsEvents=function(e){function t(){$(".js-apress-analytics-view").each(function(){a($(this).data())})}function n(e,t){var n=e.analyticsParams.context,i=n.match(/%.*?%/g);i&&i.forEach(function(e){n=n.replace(e,t[0][e.replace(/%/g,"")].value)}),e.analyticsParams.context=n}function i(e){var t=$(e.target),i=t.find(".js-apress-analytics-submit"),o=i.data();o&&(n(o,t),a(o))}function a(e,t){var n=e.analyticsParams;Array.isArray(e.companies)?$.each(e.companies,function(e,i){r($.extend(n,{company_id:i}),t)}):r($.extend(n,{company_id:e.companies}),t)}function o(){$doc.on("click",".js-apress-analytics-action",function(){a($(this).data())}).on("send:apressAnalytics",function(e,t,n){a(t,n)}).on("submit",i)}function r(e,t){$.ajax({url:app.config.crmAnalyticsCollectURL,data:e,declineCredentials:!0,complete:function(){t&&t.resolve()}})}return e.load=function(){app.config.crmAnalyticsCollectURL&&t(),o()},e}(app.modules.sendAnalyticsEvents||{});